(this.webpackJsonpchat_app=this.webpackJsonpchat_app||[]).push([[0],{281:function(e,t,n){},282:function(e,t,n){},283:function(e,t,n){},382:function(e,t,n){},383:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),c=n.n(a),i=n(17),s=n.n(i),o=n(11),u=n(438),d=n(426),l=n(387),f=n(7),j=n(427),p=Object(f.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper)},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(d.a),b=Object(j.a)((function(e){return{root:{display:"flex","& > *":{margin:e.spacing(1)}}}}));function m(e){var t=e.name,n=e.picture,a=e.online,c=e.sizeInPixel,i=b(),s={width:"".concat(c,"px"),height:"".concat(c,"px")},o=Object(r.jsx)(l.a,{style:s,alt:t,src:n});return Object(r.jsx)("div",{className:i.root,children:a?Object(r.jsx)(p,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",children:o}):o})}var O,h=n(431),v=n(432),x=n(66),g=n(451),y=n(430),w=n(197),C=n.n(w),S={mainAppBar:"#main-app-bar"},_=n(23),k=n(29),I=n(8),F=n(39),U=n(5),q=n.n(U),R=n(9),B=n(18),T=n(22),N=n.n(T),M="https://pa-chat-api.glitch.me",A="".concat(M,"/user"),E={findByUsername:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(A,"/getUserByUsername"),{params:{username:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findByUsernameAndPassword:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/getUserByUsernameAndPassword"),{username:t,password:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),createAccount:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/createAccount"),{username:t,password:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),findAllFriendsByUsername:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(A,"/getFriendsByUsername"),{params:{username:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findSentRequestFriendById:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(A,"/getSentRequestFriendById"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findStrangerByUsername:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(A,"/getStrangerByUsername"),{params:{username:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),sentFriendRequest:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/sentFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),unfriend:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/unfriend"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),cancelFriendRequest:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/cancelFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),deleteFriendRequest:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/deleteFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),confirmFriendRequest:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/confirmFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),findUsersByIds:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/getUsersByIds"),{ids:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findReceivers:function(){var e=Object(R.a)(q.a.mark((function e(t,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(A,"/getReceivers"),{username:t,exceptIds:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},L={ucFirst:function(e){if(e)return e.slice(0,1).toUpperCase()+e.slice(1)},titleCase:function(e){var t=this;if(e){var n=(e=e.trim()).split(" ");return(n.length>1?n.reduce((function(e){return t.ucFirst(e)+" "})):this.ucFirst(n[0])).trim()}},sleep:function(e){return new Promise((function(t){return setTimeout((function(){t()}),e)}))},isFn:function(e){return"function"===typeof e},format:function(e){for(var t=e,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(e&&r.length>0)for(var c in r)t=t.replace("{".concat(c,"}"),r[c]);return t},getArrayOfFieldValue:function(e,t,n){return e.map((function(e){return"string"===n?e[t].toString():e[t]}))},arrayDiff:function(e,t){var n,r,a=[];return e.length>t.length?(n=e,r=t):(n=t,r=e),n.forEach((function(e){-1===r.indexOf(e)&&a.push(e)})),a}},D=n(135),P={getUTCNow:function(){var e=new Date,t=e.getTime(),n=e.getTimezoneOffset();return t-(n*=6e4)},getCurrentTimeByUTCTime:function(e){var t=(new Date).getTimezoneOffset();return e+(t*=6e4)},getMessageTimeString:function(e){var t=new Date(e),n=new Date;return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()?D(e,"HH:MM"):D(e,"dd/mm/yyyy HH:MM")}},z=n(191),W=Object(z.io)(M,{"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]}),H={updateUser:"update-user",signIn:"sign-in",signOut:"sign-out",getOnlineUsers:"get-online-users",typing:"typing",stopTyping:"stop-typing",sendMessage:"send-message",receiveMessage:"receive-message",newMessageNotification:"new-message-notification",onlineUsers:"online-users",joinUsersToConversation:"join-users-to-conversation",joinRoom:"join-room",leaveRoom:"leave-room",acceptFriend:"accept-friend",addFriend:"add-friend",unfriend:"unfriend",cancelFriendRequest:"cancel-friend-request",deleteFriendRequest:"delete-friend-request",friendRequestCanceled:"friend-request-canceled",friendRejected:"friend-rejected",friendAccepted:"friend-accepted",friendRequested:"friend-requested",friendUnfriend:"friend-unfriend"},V={emitSignIn:function(e){W.emit(H.signIn,{user:e})},emitSignOut:function(e){W.emit(H.signOut,{user:e})},emitGetOnlineUsers:function(){W.emit(H.getOnlineUsers)},emitUpdateUserById:function(e){W.emit(H.updateUser,{id:e})},emitSendMessage:function(e,t,n){W.emit(H.sendMessage,{user:e,message:t,conversationId:n})},emitTyping:function(e,t){W.emit(H.typing,{user:e,conversationId:t})},emitStopTyping:function(e,t){W.emit(H.stopTyping,{username:e,conversationId:t})},emitJoinUsersToConversation:function(e,t){W.emit(H.joinUsersToConversation,{ids:e,conversationId:t})},emitJoinRoom:function(e){W.emit(H.joinRoom,{roomName:e})},emitLeaveRoom:function(e){W.emit(H.leaveRoom,{roomName:e})},emitAddFriend:function(e,t){W.emit(H.addFriend,{user:e,friendId:t})},emitAcceptFriend:function(e,t){W.emit(H.acceptFriend,{user:e,friendId:t})},emitUnfriend:function(e,t){W.emit(H.unfriend,{user:e,friendId:t})},emitCancelFriendRequest:function(e,t){W.emit(H.cancelFriendRequest,{user:e,friendId:t})},emitDeleteFriendRequest:function(e,t){W.emit(H.deleteFriendRequest,{user:e,friendId:t})},onUpdateUser:function(e){W.on(H.updateUser,(function(t){L.isFn(e)&&e(t)}))},onReceiveMessage:function(e){W.on(H.receiveMessage,(function(t){L.isFn(e)&&e(t)}))},onOnlineUsers:function(e){W.on(H.onlineUsers,(function(t){L.isFn(e)&&e(t)}))},onTyping:function(e){W.on(H.typing,(function(t){L.isFn(e)&&e(t)}))},onStopTyping:function(e){W.on(H.stopTyping,(function(t){L.isFn(e)&&e(t)}))},onNewMessageNotification:function(e){W.on(H.newMessageNotification,e)},onFriendAccepted:function(e){W.on(H.friendAccepted,e)},onFriendRequested:function(e){W.on(H.friendRequested,e)},onFriendUnFriend:function(e){W.on(H.friendUnfriend,e)},onFriendRequestCanceled:function(e){W.on(H.friendRequestCanceled,e)},onFriendRejected:function(e){W.on(H.friendRejected,e)},off:function(e){W.off(e)}},J=Object(B.b)("auth/login",function(){var e=Object(R.a)(q.a.mark((function e(t){var n,r,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,r=t.password,e.next=3,E.findByUsernameAndPassword(n,r);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G=Object(B.b)("auth/sentFriendRequest",function(){var e=Object(R.a)(q.a.mark((function e(t){var n,r,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,r=t.friendId,e.next=3,E.sentFriendRequest(n,r);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Y=function(e,t){V.emitSignIn(t.payload),e.user=t.payload,e.isLogged=!0},K=Object(B.d)({name:"auth",initialState:{isLogged:!1,user:null,status:"idle",error:null},reducers:{login:function(e,t){Y(e,t)},updateUser:function(e,t){e.user=t.payload},signOut:function(e){V.emitSignOut(e.user),e.user=null,e.isLogged=!1}},extraReducers:(O={},Object(F.a)(O,J.pending,(function(e,t){e.status="loading"})),Object(F.a)(O,J.fulfilled,(function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status?(Y(e,{payload:r}),e.error=null):e.error="not found",e.status="succeeded"})),Object(F.a)(O,J.rejected,(function(e,t){e.error=t.error.message,e.status="failed"})),Object(F.a)(O,G.fulfilled,(function(e,t){})),O)}),Z=function(e){return e.auth.error},$=function(e){return e.auth.status},Q=function(e){return e.auth.isLogged},X=function(e){return e.auth.user},ee=function(e){return e.auth.user._id},te=K.actions,ne=te.signOut,re=te.login,ae=te.updateUser,ce=K.reducer,ie=n(453),se=n(15),oe=n(428),ue=n(193),de=n.n(ue),le=n(192),fe=n.n(le),je=Object(B.d)({name:"theme",initialState:{type:"light"},reducers:{switchThemeType:function(e){e.type="light"===e.type?"dark":"light"}}}),pe=je.actions.switchThemeType,be=je.reducer;function me(){var e=Object(I.c)((function(e){return e.theme})),t=Object(I.b)(),n=Object(ie.a)(["theme"]),c=Object(o.a)(n,3),i=c[0],s=c[1];c[2];Object(a.useEffect)((function(){i.theme&&i.theme.type&&i.theme.type!==e.type&&t(pe())}));return Object(r.jsx)(oe.a,{"aria-label":"Day / night toggle",onClick:function(){var n=Object(se.a)(Object(se.a)({},e),{},{type:"light"===e.type?"dark":"light"});s("theme",JSON.stringify(n)),t(pe())},color:"inherit",children:"light"===e.type?Object(r.jsx)(fe.a,{}):Object(r.jsx)(de.a,{})})}var Oe=n(64);Object(f.a)((function(e){return{badge:{right:-3,top:5,border:"1px solid white",padding:"0 4px"}}}))(d.a);var he=n(196),ve=n.n(he),xe=n(195),ge=n.n(xe),ye=n(459);function we(e){var t=e.children,n=Object(Oe.a)(e,["children"]);return Object(r.jsx)(k.b,Object(se.a)(Object(se.a)({},n),{},{style:{all:"unset"},children:t}))}function Ce(){Object(_.g)();return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(we,{to:"/chat/new",children:Object(r.jsx)(ye.a,{title:"Chat",children:Object(r.jsx)(oe.a,{color:"inherit",children:Object(r.jsx)(ge.a,{})})})}),Object(r.jsx)(we,{to:"/friends",children:Object(r.jsx)(ye.a,{title:"Friends",children:Object(r.jsx)(oe.a,{color:"inherit",children:Object(r.jsx)(ve.a,{})})})})]})}var Se="loggedUser";function _e(e){var t=Object(ie.a)(Se),n=Object(o.a)(t,3),a=(n[0],n[1],n[2]),c=Object(I.c)(X),i=Object(I.b)(),s=Object(I.c)(Q),u=Object(I.c)($),d=Object(_.h)().pathname,l=Object(_.g)(),f=Object(r.jsxs)(g.a,{display:"flex",alignItems:"center",justifyContent:"center",children:[Object(r.jsx)(g.a,{mr:4,children:s?Object(r.jsx)(Ce,{}):null}),Object(r.jsx)(me,{}),s?Object(r.jsx)(m,{name:c.name,single:c.single,picture:c.picture}):null,Object(r.jsx)(y.a,{disabled:"/login"===d,startIcon:s?null:Object(r.jsx)(C.a,{}),color:"inherit",onClick:function(){a(Se),i(ne()),l.push("/")},children:Object(r.jsx)(x.a,{children:s?"Sign out":"Sign in"})})]});return Object(r.jsx)("div",{children:Object(r.jsx)(h.a,{position:"static",color:"primary",id:S.mainAppBar,children:Object(r.jsxs)(v.a,{style:{display:"flex",justifyContent:"space-between"},children:[Object(r.jsx)(x.a,{variant:"h6",children:Object(r.jsx)(k.b,{to:"/chat",color:"inherit",style:{color:"white",textDecoration:"none"},children:"Messenger"})}),"loading"!==u?f:null]})})})}n(433);var ke=n(450);var Ie=n(458),Fe="#F0F2F5",Ue=Object(j.a)((function(e){return Object(Ie.a)({table:{minWidth:650},chatSection:{width:"100%",height:"400px",overflow:"auto"},headBG:{backgroundColor:"#e0e0e0"},borderRight500:{borderRight:"1px solid #e0e0e0"},borderLeft500:{borderLeft:"1px solid #e0e0e0"},messageArea:{height:"70vh",overflowY:"auto"},RoundLightGrayInputStyle:{paddingLeft:"10px",paddingRight:"10px",backgroundColor:Fe,borderRadius:"50px"},buttonStyle:{textTransform:"none"},flexCenterVerticalStyle:{display:"flex",alignItems:"center"},flexCenterStyle:{display:"flex",alignItems:"center",justifyContent:"center"},defaultContainerPaddingStyle:{root:{"& > *":{padding:e.spacing(2)}}}})})),qe=n(434),Re=n(385),Be=n(437),Te=n(435);function Ne(e){var t=e.items,n=e.max,a=void 0===n?2:n,c=t.slice(0,a).map((function(e,t){return Object(r.jsx)(l.a,{alt:e.name,src:e.src},t)}));return Object(r.jsx)(Te.a,{max:a,spacing:"small",children:c})}var Me=n(436),Ae=n(455),Ee="".concat(M,"/conversation"),Le={findConversationById:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(Ee,"/getConversationById"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findConversationByMemberIds:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(Ee,"/getConversationByMemberIds"),{ids:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findSidebarConversationById:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(Ee,"/getSidebarConversationById"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),listConversationsForListDisplay:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(Ee,"/listConversationsForListDisplay"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findConversationInfoByUserIdsOrCreateIfNotExist:function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.post("".concat(Ee,"/getConversationInfoByUserIdsOrCreateIfNotExist"),{ids:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getHomeConversation:function(){var e=Object(R.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.a.get("".concat(Ee,"/home"));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),createConversationWithMemberIds:function(){var e=Object(R.a)(q.a.mark((function e(t){var n,r,a=arguments;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,e.next=3,N.a.post("".concat(Ee,"/createConversationWithMemberIds"),{ids:t,messageParams:n});case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},De=Object(B.b)("chat/conversation",function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationByMemberIds(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Pe=Object(B.b)("chat/conversation",function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationById(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ze=(Object(B.b)("chat/conversation",function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationByUserIdsOrCreateIfNotExist(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(B.b)("chat/conversation",Object(R.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.getHomeConversation();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))),Object(B.d)({name:"chat",initialState:{conversation:{},sidebarConversations:[],status:"idle",error:null},reducers:{appendMessage:function(e,t){e.conversation.messages.push(t.payload)},reset:function(e,t){e.conversation={},e.status="idle",e.error=null}},extraReducers:{"chat/conversation/pending":function(e,t){e.status="loading"},"chat/conversation/fulfilled":function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status?(e.conversation=r,e.error=null):e.error="not found",e.status="succeeded"},"chat/conversation/rejected":function(e,t){e.error=t.error.message,e.status="failed"}}})),We=function(e){return e.chat.status},He=function(e){return e.chat.conversation},Ve=function(e){return e.chat.conversation.members},Je=function(e){return e.chat.conversation._id},Ge=function(e){return e.chat.conversation.messages||[]},Ye=ze.actions,Ke=Ye.reset,Ze=Ye.appendMessage,$e=ze.reducer;function Qe(e){var t=e.children,n=e.item,a=Object(Oe.a)(e,["children","item"]),c=Object(_.g)(),i=Object(I.c)(X)||{},s=Object(I.c)(Ve),o=function(){var e=Object(R.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=function(){var e=Object(R.a)(q.a.mark((function e(){var t,r,a,s,o,u,d;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationInfoByUserIdsOrCreateIfNotExist([i._id,n._id]);case 2:t=e.sent,r=t.status,a=t.payload,"succeeded"===r&&(s=a.members,o=a.isNew,u=a._id,o&&V.emitJoinUsersToConversation(s,u),d=t.payload._id,c.push("/chat/t/".concat(d)));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s){e.next=6;break}return e.next=4,t();case 4:e.next=9;break;case 6:if(!(L.arrayDiff(s,[i._id,n._id]).length>0)){e.next=9;break}return e.next=9,t();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)(g.a,Object(se.a)(Object(se.a)({},a),{},{onClick:o,children:[" ",t]}))}var Xe,et=Object(j.a)({truncateListItemStyle:{"& > p":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),tt=function(e){var t=e.items;return t=t.map((function(e){return{name:e.username,src:e.picture}})),Object(r.jsx)(Ne,{items:t})};function nt(e){var t,n=e.item,a=e.online,c=e.icon,i=et(),s=Object(I.c)(X),o=Object(I.c)(Je),u=n.members,d=u.filter((function(e){return e._id!==s._id})),f=null;if(t=2===u.length?d[0].username:"".concat(d[0].username," and ").concat(d.length-1," others"),n.lastMessage){var j=n.lastMessage?n.lastMessage.from._id===s._id?"you: ":d.length>1?"".concat(n.lastMessage.from.username,": "):null:null;f=null!==j?"".concat(j," ").concat(n.lastMessage.text):n.lastMessage.text}return Object(r.jsx)(we,{to:"/chat/t/".concat(n._id),children:Object(r.jsxs)(Re.a,{button:!0,selected:o===n._id,children:[Object(r.jsx)(Me.a,{style:{width:"90px"},children:c?Object(r.jsxs)(l.a,{children:[" ",c," "]}):2===u.length?Object(r.jsx)(m,{online:a,name:t,single:!0,picture:d[0].picture}):Object(r.jsx)(tt,{items:d})}),Object(r.jsx)(Ae.a,{xsDown:!0,children:Object(r.jsx)(Be.a,{className:i.truncateListItemStyle,primary:t,secondary:f})})]})})}var rt=Object(B.b)("sidebarConversations/fetchConversations",function(){var e=Object(R.a)(q.a.mark((function e(t){var n,r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.next=3,Le.listConversationsForListDisplay(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),at=Object(B.b)("sidebarConversations/fetchAndPrependConversationById",function(){var e=Object(R.a)(q.a.mark((function e(t){var n,r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.next=3,Le.findSidebarConversationById(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ct=Object(B.c)({selectId:function(e){return e._id},sortComparer:function(e,t){return-(e.lastMessage.time-t.lastMessage.time)}}),it=ct.getInitialState({status:"idle",error:null}),st=Object(B.d)({name:"sidebarConversations",initialState:it,reducers:{updateLastMessage:function(e,t){var n=t.payload,r=n.id,a=n.message,c=e.entities[r];c?(c.lastMessage=a,ct.upsertOne(e,c)):at({id:r})}},extraReducers:(Xe={},Object(F.a)(Xe,at.fulfilled,(function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status&&ct.upsertOne(e,r)})),Object(F.a)(Xe,rt.pending,(function(e,t){e.status="loading"})),Object(F.a)(Xe,rt.fulfilled,(function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status?(ct.upsertMany(e,r),e.error=null):e.error="not found",e.status="succeeded"})),Xe)}),ot=ct.getSelectors((function(e){return e.sidebarConversations})),ut=ot.selectAll,dt=(ot.selectById,ot.selectIds),lt=st.actions.updateLastMessage,ft=st.reducer;function jt(){Ue();var e=Object(I.b)(),t=Object(I.c)(ut),n=Object(I.c)(X),c=Object(I.c)(dt),i=Object(I.c)(Je);Object(a.useEffect)((function(){e(rt({id:n._id}))}),[]),Object(a.useEffect)((function(){var t=function(t){var n=t.message,r=t.conversationId;c.indexOf(r)>-1?e(lt({id:r,message:n})):e(at({id:r}))};return V.onNewMessageNotification(t),function(){W.removeListener(H.newMessageNotification,t)}}),[i,c]);var s=t.map((function(e,t){return Object(r.jsx)(nt,{item:e},t)}));return Object(r.jsx)(u.a,{container:!0,children:Object(r.jsx)(u.a,{item:!0,xs:12,style:{height:"100%"},children:Object(r.jsx)(qe.a,{className:"custom-scrollbar conversation-list",children:s})})})}var pt=n(441),bt=n(208),mt={enabled:!1,receivers:[]},Ot=Object(B.d)({name:"newChat",initialState:mt,reducers:{setEnabled:function(e,t){e.enabled=t.payload},removeReceiverById:function(e,t){e.receivers=e.receivers.filter((function(e){return e._id!==t.payload}))},appendReceiver:function(e,t){e.receivers.push(t.payload)},removeLastReceiver:function(e,t){e.receivers.length>0&&(e.receivers=e.receivers.slice(0,-1))},reset:function(e,t){e.enabled=mt.enabled,e.receivers=mt.receivers}}}),ht=function(e){return e.newChat.receivers},vt=function(e){return e.newChat.enabled},xt=function(e){return 1===e.newChat.receivers.length?e.newChat.receivers[0]:null},gt=Ot.actions,yt=gt.removeReceiverById,wt=gt.appendReceiver,Ct=gt.removeLastReceiver,St=gt.setEnabled,_t=gt.reset,kt=Ot.reducer;function It(){return Object(r.jsx)(x.a,{align:"center",className:"text-muted",children:"Loading..."})}function Ft(e){var t=e.notShowAvatar,n=e.ownMessage,a=e.time,c=e.user,i=e.message,s=t?null:Object(r.jsx)(m,{sizeInPixel:20,name:c.username,picture:c.picture}),o=n?"right":"left",u=n?"flex-end":"flex-start",d=n?"bottom-start":"bottom-end";return Object(r.jsx)(Re.a,{children:Object(r.jsxs)(g.a,{width:"100%",style:{display:"flex",justifyContent:u,alignItems:"flex-end"},children:[n?null:s,Object(r.jsx)(g.a,{className:"message ".concat(o,"-message ").concat(!n&&t?"ml-avatar":""),children:Object(r.jsx)(ye.a,{title:P.getMessageTimeString(P.getCurrentTimeByUTCTime(a)),placement:d,children:Object(r.jsx)(Be.a,{align:o,primary:i})})})]})},"1")}function Ut(e){var t,n=e.username,a=e.type,c=Object(r.jsx)(x.a,{component:"span",color:"primary",children:n});switch(a){case"welcome-current-user-notification":t="Welcome to the chat room.";break;case"welcome-other-user-notification":t=Object(r.jsxs)("span",{children:[c," has joined the chat."]});break;case"user-left-notification":t=Object(r.jsxs)("span",{children:[c," has left the chat."]});break;default:t=""}return Object(r.jsx)(x.a,{align:"center",className:"text-muted",children:t})}n(281);var qt=Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(g.a,{mt:4,children:Object(r.jsx)(x.a,{className:"text-muted",align:"center",children:"Let's start a conversation."})})});function Rt(e){var t=e.messages,n=Ue(),i=Object(I.c)(X),s=Object(I.c)(vt),o=t.map((function(e,n){if(e.from){var a=!1;if(n<t.length-1){var c=t[n+1];a="message"===c.type&&c.from.username===e.from.username}return Object(r.jsx)(Ft,{notShowAvatar:a,ownMessage:e.from.username===i.username,user:e.from,message:e.text,time:e.time},n)}return Object(r.jsx)(Ut,{username:e.user.username,type:e.type},n)}));return Object(a.useEffect)((function(){!function(){var e=document.getElementById("my-messages-container");e.scrollTop=e.scrollHeight}()}),[t]),Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(qe.a,{className:"".concat(n.messageArea," custom-scrollbar"),id:"my-messages-container",children:o.length>0?o:s?null:qt})})}var Bt,Tt=n(439),Nt=n(440),Mt=Object(B.d)({name:"notify",initialState:{message:"",type:"",open:!1,timeout:4e3},reducers:{setNotify:function(e,t){var n=t.payload,r=n.message,a=n.type,c=n.open,i=n.timeout;c&&(e.message=r||"",e.type=a||"",e.timeout=i||6e3),e.open=c||!1}}}),At=function(e){return e.notify.open},Et=function(e){return e.notify.message},Lt=function(e){return e.notify.type},Dt=function(e){return e.notify.timeout},Pt=Mt.actions.setNotify,zt=Mt.reducer,Wt={invalid:"{0} invalid",fail:"Something went wrong",welcomeNewAccount:"Hello {0}, let's start a chat with your fiends!",PleaseTypeMessage:"Please type some message to send!",newMessage:"{0}: {1}",friendRequested:"{0} sent you a friend request.",unfriended:"{0} unfriended you.",friendAccepted:"{0} accepted your friend request."};function Ht(){var e=Object(a.useState)(""),t=Object(o.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(!1),s=Object(o.a)(i,2),d=s[0],l=s[1],f=Object(I.b)(),j=Object(_.g)(),p=Object(I.c)(X),b=Object(I.c)(He),m=Object(I.c)(ht),O=Object(I.c)(vt),h=function(){""===n.trim()?f(Pt({message:Wt.PleaseTypeMessage,open:!0,timeout:2e3})):(V.emitSendMessage(p,n,b._id),c("")),O&&j.push("/chat/t/".concat(b._id))},v=function(){var e=Object(R.a)(q.a.mark((function e(){var t,r,a,i;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=L.getArrayOfFieldValue(m,"_id").concat(p._id),e.next=3,Le.createConversationWithMemberIds(t);case 3:r=e.sent,a=r.status,i=r.payload,"succeeded"===a&&(V.emitJoinUsersToConversation(i.members,i._id),V.emitSendMessage(p,n,i._id),c(""),j.push("/chat/t/".concat(i._id)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){d&&(V.emitStopTyping(p.username,b._id),l(!1))};return Object(r.jsx)("form",{onSubmit:function(e){!function(e){e.preventDefault(),b._id?h():O&&m.length>0?v():alert("nothing")}(e)},children:Object(r.jsxs)(u.a,{container:!0,style:{padding:"20px"},children:[Object(r.jsx)(u.a,{item:!0,xs:10,md:11,children:Object(r.jsx)(ke.a,{autoFocus:!0,inputProps:{autoComplete:"off"},value:n,id:"outlined-basic-email",fullWidth:!0,onChange:function(e){c(e.target.value)},onKeyUp:function(e){13!==e.which?n.length>3&&(d||""===n.trim()||V.emitTyping(p,b._id),l(!0),clearTimeout(Bt),Bt=setTimeout((function(){x()}),2e3)):x()},onBlur:function(){x()}})}),Object(r.jsx)(u.a,{item:!0,xs:2,md:1,align:"center",children:Object(r.jsx)(Tt.a,{color:"primary","aria-label":"add",onClick:h,children:Object(r.jsx)(Nt.a,{})})})]})})}function Vt(e){var t=e.type;return Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(Ht,{type:t})})}function Jt(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1];Object(a.useEffect)((function(){return V.onTyping((function(e){c(n.concat(e.user))})),V.onStopTyping((function(e){c(n.filter((function(t){return t.username!==e.username})))})),function(){W.off(H.typing),W.off(H.stopTyping)}}));var i=n.map((function(e){return Object(r.jsx)("div",{children:Object(r.jsxs)("div",{style:{display:"flex",alignItems:"flex-start"},children:[Object(r.jsx)("span",{children:Object(r.jsx)(m,{name:e.username,picture:e.picture,children:" "})}),Object(r.jsx)("img",{className:"typing-icon",src:"".concat("/chat","/images/icons/typing-icon.gif"),alt:"typing"})]})},e._id)}));return Object(r.jsx)(bt.a,{elevation:0,style:{minWidth:"200px"},children:i.length>0?i:null})}function Gt(){var e=Object(I.c)(We),t=Object(I.c)(Ge),n=Object(I.c)(He),i=Object(I.b)(),s=Object(_.g)(),o=Object(I.c)(ee),u=Object(_.i)().conversationId,d=Object(I.c)(xt)||{},l=Object(I.c)(vt);return Object(a.useEffect)((function(){l&&(d._id?i(De(["".concat(o),"".concat(d._id)])):i(Ke()))}),[d._id,l]),Object(a.useEffect)((function(){return"succeeded"===e&&(n._id?V.emitJoinRoom("".concat(n._id,"_current")):s.replace("/chat/new")),function(){n._id&&V.emitLeaveRoom("".concat(n._id,"_current"))}}),[e,n._id]),Object(a.useEffect)((function(){u&&i(Pe(u))}),[u]),Object(a.useEffect)((function(){return function(){i(Ke())}}),[]),Object(a.useEffect)((function(){return V.onReceiveMessage((function(e){var t=e.conversationId,r=e.message;if(t===n._id){var a=Object(se.a)({type:"message"},r);i(Ze(a))}})),function(){V.off(H.receiveMessage)}}),[t,n._id]),Object(r.jsx)(c.a.Fragment,{children:"loading"===e?Object(r.jsx)(It,{}):Object(r.jsx)(Rt,{messages:t})})}var Yt,Kt=n(454),Zt=n(198),$t=n.n(Zt);n(282),n(283);function Qt(e){var t=e.items,n=void 0===t?[]:t,a=e.onItemClick;return Object(r.jsx)(qe.a,{className:"suggestion-receiver-list",dense:!1,children:function(e){return e.map((function(e){return Object(r.jsxs)(Re.a,{button:!0,onClick:function(){a(e)},children:[Object(r.jsx)(Me.a,{children:Object(r.jsx)(l.a,{src:e.picture,children:" "})}),Object(r.jsx)(Be.a,{primary:e.username,secondary:null})]},e._id)}))}(n)})}var Xt=function(e){var t=e.items,n=e.onCloseClick;return t.map((function(e){return Object(r.jsxs)(Kt.a,{className:"selected-receiver",severity:"info",icon:!1,action:Object(r.jsx)(oe.a,{"aria-label":"close",color:"inherit",size:"small",onClick:function(){n(e)},children:Object(r.jsx)($t.a,{fontSize:"inherit"})}),children:[" ",e.username]},e._id)}))};function en(e){var t=e.onFriendIdSelected,n=Object(I.b)(),c=Object(a.useState)(!0),i=Object(o.a)(c,2),s=i[0],u=i[1],d=Object(a.useState)([]),l=Object(o.a)(d,2),f=l[0],j=l[1],p=Object(a.useState)(""),b=Object(o.a)(p,2),m=b[0],O=b[1],h=Object(a.useState)(""),v=Object(o.a)(h,2),y=v[0],w=v[1],C=Object(a.useRef)(null),S=Object(I.c)(ee),_=Object(I.c)(ht);Object(a.useEffect)((function(){u(!0);var e=function(){var e=Object(R.a)(q.a.mark((function e(){var t,n,r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.findReceivers(y,L.getArrayOfFieldValue(_,"_id").concat(S));case 2:t=e.sent,n=t.status,r=t.payload,"succeeded"===n&&s&&j(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return""!==y.trim()&&e(),function(){u(!1)}}),[y,_,S]),Object(a.useEffect)((function(){1===_.length?t(_[0]._id):t(null)}),[_]);var k=function(e,t,r){8===e.which&&""===t.trim()&&""===r.trim()&&n(Ct())};return Object(r.jsxs)(g.a,{className:"receiver-wrapper",children:[Object(r.jsx)(x.a,{className:"receiver-label",children:"To: "}),Object(r.jsxs)(g.a,{className:"receiver-container",display:"inline-block",children:[Object(r.jsx)(Xt,{items:_,onCloseClick:function(e){n(yt(e._id))}}),Object(r.jsxs)(g.a,{className:"receiver-input-container",children:[Object(r.jsx)(ke.a,{placeholder:"Receiver",ref:C,className:"receiver-input",autoFocus:!0,onKeyUp:function(e){var t=e.target.value;k(e,m,t)},onChange:function(e){var t=e.target.value;O(t),clearTimeout(Yt),Yt=setTimeout((function(){w(t)}),500)},onBlur:function(e){var t=e.target.value;k(e,m,t)},value:m}),f.length>0?Object(r.jsx)(Qt,{items:f,onItemClick:function(e){n(wt(e)),O(""),w(""),j([]),C.current.querySelector("input").focus()}}):null]})]})]})}function tn(){var e=Object(a.useState)(null),t=Object(o.a)(e,2),n=t[0],c=t[1],i=Object(I.b)();return Object(a.useEffect)((function(){return i(St(!0)),function(){i(_t())}}),[]),Object(r.jsxs)(g.a,{position:"relative",children:[Object(r.jsx)(bt.a,{style:{position:"absolute",zIndex:"1000",width:"100%",boxShadow:"none"},children:Object(r.jsx)(en,{onFriendIdSelected:function(e){c(e)}})}),Object(r.jsx)(g.a,{children:Object(r.jsx)(Gt,{friendId:n,type:"temp"})})]})}function nn(e){var t=e.children,n=Object(a.useState)(!0),i=Object(o.a)(n,1)[0],s=Object(_.i)(),u=Object(_.g)(),d=Object(a.useState)(null),l=Object(o.a)(d,2),f=l[0],j=l[1],p=Object(I.c)(We);Object(a.useEffect)((function(){var e=s.type,t=s.conversationId;if(e)switch(e){case"t":t||u.replace("/chat"),j("chat");break;case"new":t&&u.replace("/chat/new"),j("new")}else j("chat");return function(){}}),[s]);var b=Object(r.jsx)(c.a.Fragment,{children:Object(r.jsxs)("div",{style:{position:"relative"},children:["chat"===f?Object(r.jsx)(Gt,{}):Object(r.jsx)(tn,{}),Object(r.jsxs)("div",{style:{position:"absolute",bottom:"100px",left:"5px",width:"100%"},children:[Object(r.jsx)(Jt,{}),Object(r.jsx)(pt.a,{})]}),Object(r.jsx)(g.a,{display:"loading"===p?"none":"unset",children:Object(r.jsx)(Vt,{})})]})});return Object(r.jsxs)(c.a.Fragment,{children:[" ",i?b:t," "]})}function rn(e){var t=e.title;return Object(r.jsx)(x.a,{variant:"h5",children:t})}var an=Object(j.a)((function(e){return{root:{width:"100%"}}}));function cn(e){e.item;var t=an(),n=Object(a.useState)([]),i=Object(o.a)(n,2),s=i[0],u=i[1],d=Object(a.useState)(!1),l=Object(o.a)(d,2),f=l[0],j=l[1],p=Object(I.c)(X)||{};Object(a.useEffect)((function(){return setTimeout((function(){j(!0)}),500),V.emitGetOnlineUsers(),V.onOnlineUsers((function(e){u(e)})),function(){W.off(H.onlineUsers)}}),[]);var b=s.filter((function(e){return e.username!==p.username})).map((function(e){return Object(r.jsxs)(Qe,{button:!0,component:Re.a,item:e,children:[Object(r.jsx)(Me.a,{children:Object(r.jsx)(m,{online:!0,name:e.name,single:e.single,picture:e.picture})}),Object(r.jsx)(Ae.a,{smDown:!0,children:Object(r.jsx)(Be.a,{primary:e.username})})]},e._id)})),O=Object(r.jsx)(x.a,{className:"text-muted",align:"center",children:"No online users"});return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(rn,{title:"Online"}),Object(r.jsx)(qe.a,{className:t.root,children:f?b.length>0?b:O:null})]})}function sn(){var e=Ue(),t=Object(a.useState)(0),n=Object(o.a)(t,2),c=n[0];n[1],"calc(100vh - ".concat(c,"px)");return Object(a.useEffect)((function(){}),[]),Object(r.jsx)(g.a,{p:2,children:Object(r.jsx)(u.a,{container:!0,children:Object(r.jsxs)(u.a,{container:!0,item:!0,xs:12,spacing:2,children:[Object(r.jsx)(u.a,{item:!0,xs:4,md:3,className:"".concat(e.borderRight500),children:Object(r.jsx)(jt,{})}),Object(r.jsx)(u.a,{item:!0,xs:8,md:7,children:Object(r.jsx)(nn,{children:"Loading..."})}),Object(r.jsx)(u.a,{item:!0,xs:!1,md:2,className:"".concat(e.borderLeft500," "),children:Object(r.jsx)(cn,{})})]})})})}var on=n(443),un=n(113),dn=n.n(un),ln=n(442),fn=n(114),jn=n(40),pn={required:"{0} required",lengthGreater:"{0} must greater than {1} characters",noSpecialCharacter:"{0} must not contain special characters",unique:"{0} must be unique",match:"{0} must match"},bn=Object(j.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function mn(){var e=Object(I.b)(),t=Object(a.useState)(!1),n=Object(o.a)(t,2),c=n[0],i=n[1],s=Object(I.c)(Q),u=Object(ie.a)([Se]),d=Object(o.a)(u,2),f=(d[0],d[1]),j=Object(I.c)($),p=Object(I.c)(Z),b=bn();if(c)"succeeded"===j&&p&&e(Pt({message:"Login unsuccessfully",type:"error",open:!0}));else if("loading"===j)return null;var m=Object(r.jsxs)(ln.a,{component:"main",maxWidth:"xs",children:[Object(r.jsx)(on.a,{}),Object(r.jsxs)("div",{className:b.paper,children:[Object(r.jsx)(l.a,{className:b.avatar,children:Object(r.jsx)(dn.a,{})}),Object(r.jsx)(x.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(r.jsx)(fn.a,{initialValues:{username:"",password:"",passwordConfirmation:""},validationSchema:jn.a({username:jn.c().required(L.format(pn.required,"Username")),password:jn.c().required(L.format(pn.required,"Password"))}),onSubmit:function(){var t=Object(R.a)(q.a.mark((function t(n,r){var a,c,s;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.setSubmitting,a=n.username,c=n.password,s={username:a,password:c},i(!0),e(J(s)),f(Se,s);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),children:function(e){var t=e.values,n=e.errors,a=e.touched,c=e.handleChange,i=e.handleBlur,s=e.handleSubmit,o=e.isSubmitting,u=e.isValid,d=e.dirty,l={};for(var f in n)l[f]=null!=n[f]&&a[f];var j=function(e,r){return{fullWidth:!0,margin:"normal",placeholder:r=r||L.ucFirst(e),variant:"outlined",name:e,onChange:c,onBlur:i,value:t[r],label:r,error:l[e],helperText:l[e]?n[e]:null}};return Object(r.jsxs)("form",{onSubmit:s,noValidate:!0,autoComplete:"off",children:[Object(r.jsx)(ke.a,Object(se.a)({autoFocus:!0,type:"text"},j("username"))),Object(r.jsx)(ke.a,Object(se.a)({type:"password"},j("password"))),Object(r.jsx)(we,{to:"/sign-up",children:Object(r.jsx)(x.a,{color:"primary",children:"Create an account"})}),Object(r.jsx)(g.a,{mt:2,children:Object(r.jsx)(y.a,{disabled:o||!u||!d,type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:" Sign In"})})]})}})]})]});return s?null:m}var On=function(){var e=Object(R.a)(q.a.mark((function e(t){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,E.findByUsername(t);case 3:return n=e.sent,e.abrupt("return","succeeded"===n.status);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hn=function(e,t){return!!e&&e.length>=t},vn=function(e){return!!e&&/^[a-zA-Z0-9]+$/.test(e)},xn={username:function(e,t,n){var r="Username";return jn.c().required(L.format(pn.required,r)).test("length",L.format(pn.lengthGreater,r,4),(function(e,t){return hn(e,4)})).test("specialCharacter",L.format(pn.noSpecialCharacter,r),(function(e,t){return vn(e)})).test("usernameExist",L.format(pn.unique,r),function(){var r=Object(R.a)(q.a.mark((function r(a,c){return q.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!hn(a,4)||!vn(a)){r.next=6;break}if(a===e.value){r.next=6;break}if(clearTimeout(n),a){r.next=5;break}return r.abrupt("return",!0);case 5:return r.abrupt("return",new Promise((function(e,r){n=setTimeout(Object(R.a)(q.a.mark((function n(){var r;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,On(a);case 2:r=n.sent,t({value:a,unique:!r}),e(!r);case 5:case"end":return n.stop()}}),n)}))),500)})));case 6:return r.abrupt("return",e.unique);case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())},password:function(){var e="Password";return jn.c().required(L.format(pn.required,e)).matches(/[a-zA-Z0-9]{3,}/,L.format(pn.lengthGreater,e))},passwordConfirmation:function(){var e="Password confirmation";return jn.c().required(L.format(pn.required,e)).oneOf([jn.b("password")],L.format(pn.match,e))}},gn=Object(j.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)}}}));function yn(){var e=Object(I.b)(),t=Object(a.useState)({value:"",unique:!1}),n=Object(o.a)(t,2),c=n[0],i=n[1],s=Object(I.c)(Q),u=Object(I.c)($),d=gn();return"loading"===u||s?null:Object(r.jsxs)(ln.a,{component:"main",maxWidth:"xs",children:[Object(r.jsx)(on.a,{}),Object(r.jsxs)("div",{className:d.paper,children:[Object(r.jsx)(l.a,{className:d.avatar,children:Object(r.jsx)(dn.a,{})}),Object(r.jsx)(x.a,{component:"h1",variant:"h5",children:"Sign Up"}),Object(r.jsx)(fn.a,{initialValues:{username:"",password:"",passwordConfirmation:""},validationSchema:jn.a({username:xn.username(c,i,undefined),password:xn.password(),passwordConfirmation:xn.passwordConfirmation()}),onSubmit:function(){var t=Object(R.a)(q.a.mark((function t(n,r){var a,c,i,s,o;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.setSubmitting,c=n.username,i=n.password,t.next=4,E.createAccount(c,i);case 4:"succeeded"===(s=t.sent).status?(o=s.payload,e(Pt({message:L.format(Wt.welcomeNewAccount,o.username)})),e(re(o))):a(!1);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),children:function(e){var t=e.values,n=e.errors,a=e.touched,c=e.handleChange,i=e.handleBlur,s=e.handleSubmit,o=e.isSubmitting,u=e.isValid,d=e.dirty,l={};for(var f in n)l[f]=null!=n[f]&&a[f];var j=function(e,r){return{fullWidth:!0,margin:"normal",placeholder:r=r||L.ucFirst(e),variant:"outlined",name:e,onChange:c,onBlur:i,value:t[r],label:r,error:l[e],helperText:l[e]?n[e]:null}};return Object(r.jsxs)("form",{onSubmit:s,noValidate:!0,autoComplete:"off",children:[Object(r.jsx)(ke.a,Object(se.a)({type:"text"},j("username"))),Object(r.jsx)(ke.a,Object(se.a)({type:"password"},j("password"))),Object(r.jsx)(ke.a,Object(se.a)({type:"password"},j("passwordConfirmation","Password confirmation"))),Object(r.jsx)(we,{to:"/signin",children:Object(r.jsx)(x.a,{color:"primary",children:"Have an account?"})}),Object(r.jsx)(g.a,{mt:2,children:Object(r.jsx)(y.a,{disabled:o||!u||!d,type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:" Sign Up "})})]})}})]})]})}var wn=n(457);function Cn(e){return Object(r.jsx)(Kt.a,Object(se.a)({elevation:6,variant:"filled"},e))}var Sn=Object(j.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}}));function _n(){var e=Sn(),t=Object(I.b)(),n=Object(I.c)(At),a=Object(I.c)(Et),c=Object(I.c)(Lt),i=Object(I.c)(Dt),s=function(e,n){"clickaway"!==n&&t(Pt({open:!1}))};return Object(r.jsx)("div",{className:e.root,children:a?Object(r.jsx)(wn.a,{open:n,autoHideDuration:i,onClose:s,anchorOrigin:{horizontal:"right",vertical:"top"},message:a,children:""!==c?Object(r.jsx)(Cn,{onClose:s,severity:c,children:a}):null}):""})}function kn(e){var t=e.children,n=Object(Oe.a)(e,["children"]),a=Object(I.c)(Q);return Object(r.jsx)(_.b,Object(se.a)(Object(se.a)({},n),{},{render:function(e){var n=e.location;return a?t:Object(r.jsx)(_.a,{to:{pathname:"/login",state:{from:n}}})}}))}var In=n(204),Fn=n(449),Un=(n(382),n(452)),qn=n(448),Rn=n(445),Bn=n(446),Tn=n(447);function Nn(e){var t=e.item,n=Ue(),a=Object(I.c)(X),i=function(){var e=Object(R.a)(q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.cancelFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(V.emitUpdateUserById(a._id),V.emitCancelFriendRequest(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(y.a,{onClick:i,variant:"contained",size:"small",className:n.buttonStyle,children:"Cancel request"})})}function Mn(e){var t=e.item,n=Ue(),a=Object(I.c)(X),i=function(){var e=Object(R.a)(q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.confirmFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(V.emitUpdateUserById(a._id),V.emitAcceptFriend(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s=function(){var e=Object(R.a)(q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.deleteFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(V.emitUpdateUserById(a._id),V.emitDeleteFriendRequest(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(y.a,{onClick:i,color:"primary",variant:"contained",size:"small",className:n.buttonStyle,children:"Confirm"}),Object(r.jsx)(y.a,{onClick:s,variant:"contained",size:"small",className:n.buttonStyle,children:"Delete"})]})}function An(e){var t=e.item,n=Ue(),a=Object(I.c)(X),i=function(){var e=Object(R.a)(q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.sentFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(V.emitUpdateUserById(a._id),V.emitAddFriend(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(y.a,{onClick:i,color:"primary",variant:"contained",size:"small",className:n.buttonStyle,children:"Add friend"})})}var En=n(205),Ln=n(444),Dn=n(133),Pn=n.n(Dn);function zn(e){var t=e.item,n=Object(I.c)(X),c=Ue(),i=Object(a.useState)(null),s=Object(o.a)(i,2),u=s[0],d=s[1],l=Boolean(u),f=function(){var e=Object(R.a)(q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.unfriend(n._id,t._id);case 2:"succeeded"===e.sent.status&&(V.emitUpdateUserById(n._id),V.emitUnfriend(n,t._id)),d(null);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)(oe.a,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:function(e){d(e.currentTarget)},children:Object(r.jsx)(Pn.a,{})}),Object(r.jsxs)(En.a,{id:"long-menu",anchorEl:u,keepMounted:!0,open:l,onClose:function(){d(null)},PaperProps:{style:{maxHeight:216,width:"20ch"}},children:[Object(r.jsx)(Ln.a,{children:Object(r.jsx)(Qe,{item:t,style:{width:"100%"},children:Object(r.jsx)(y.a,{onClick:function(){d(null)},variant:"contained",size:"small",fullWidth:!0,color:"primary",className:c.buttonStyle,children:"Chat"})})}),Object(r.jsx)(Ln.a,{children:Object(r.jsx)(y.a,{onClick:f,variant:"contained",size:"small",fullWidth:!0,className:c.buttonStyle,children:"Unfriend"})})]})]})}function Wn(e){var t=e.items,n=e.type,a=e.isLoading,i=Object(I.c)(X),s=t.map((function(e,t){var a,c;c="friend"===(a=n||function(e,t){var n=e.friend,r=n.friend,a=n.request,c=n.sent_request;return r.indexOf(t)>-1?"friend":a.indexOf(t)>-1?"request":c.indexOf(t)>-1?"sent_request":"stranger"}(i,e._id))?Object(r.jsx)(zn,{item:e}):"sent_request"===a?Object(r.jsx)(Nn,{item:e}):"request"===a?Object(r.jsx)(Mn,{item:e}):Object(r.jsx)(An,{item:e});var s=Object(r.jsxs)(Rn.a,{style:{justifyContent:"flex-end"},children:[" ",c," "]});return Object(r.jsx)(u.a,{item:!0,xs:12,md:6,lg:4,children:Object(r.jsx)(Bn.a,{children:Object(r.jsx)(Tn.a,{avatar:Object(r.jsx)(m,{name:e.username,picture:e.picture,children:" "}),action:s,title:e.username,subheader:null})})},t)})),o=Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(u.a,{item:!0,xs:12,children:a?Object(r.jsx)(It,{}):Object(r.jsx)(x.a,{align:"center",className:"text-muted",children:"Your list is empty"})})});return Object(r.jsx)(c.a.Fragment,{children:s.length>0?s:o})}var Hn=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(!0),s=Object(o.a)(i,2),u=s[0],d=s[1],l=Object(I.c)(X);return Object(a.useEffect)((function(){var e=function(){var e=Object(R.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.findUsersByIds(l.friend.friend);case 3:"succeeded"===(t=e.sent).status&&c(t.payload),d(!1),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();l.friend.friend.length>0?e():(c([]),d(!1))}),[l.friend.friend]),Object(r.jsx)(Wn,{items:n,type:"friend",isLoading:u})},Vn=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(!0),s=Object(o.a)(i,2),u=s[0],d=s[1],l=Object(I.c)(X);return Object(a.useEffect)((function(){var e=function(){var e=Object(R.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.findUsersByIds(l.friend.sent_request);case 3:"succeeded"===(t=e.sent).status&&c(t.payload),d(!1),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();l.friend.sent_request.length>0?e():(d(!1),c([]))}),[l.friend.sent_request]),Object(r.jsx)(Wn,{items:n,type:"sent_request",isLoading:u})},Jn=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(!0),s=Object(o.a)(i,2),u=s[0],d=s[1],l=Object(I.c)(X);return Object(a.useEffect)((function(){var e=function(){var e=Object(R.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.findUsersByIds(l.friend.request);case 3:"succeeded"===(t=e.sent).status&&c(t.payload),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();l.friend.request.length>0?e():(c([]),d(!1)),d(!1)}),[l.friend.request]),Object(r.jsx)(Wn,{items:n,type:"request",isLoading:u})},Gn=function(e){var t=e.username,n=Object(a.useState)([]),c=Object(o.a)(n,2),i=c[0],s=c[1],u=Object(a.useState)(!0),d=Object(o.a)(u,2),l=d[0],f=d[1];return Object(a.useEffect)((function(){(function(){var e=Object(R.a)(q.a.mark((function e(){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.findStrangerByUsername(t);case 3:"succeeded"===(n=e.sent).status&&s(n.payload),f(!1),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}})()()}),[t]),Object(r.jsx)(Wn,{items:i,isLoading:l})};function Yn(e){var t=e.type,n=null,a=Object(I.c)(Q),c=Object(I.c)(X);if(a)switch(t){case"friends_request":n=Object(r.jsx)(Jn,{username:c.username});break;case"friends_sent_request":n=Object(r.jsx)(Vn,{username:c.username});break;case"people_may_know":n=Object(r.jsx)(Gn,{username:c.username});break;default:n=Object(r.jsx)(Hn,{username:c.username})}return Object(r.jsx)(u.a,{style:{paddingTop:"8px",maxHeight:"500px",overflowY:"auto"},className:"custom-scrollbar",container:!0,spacing:2,children:n})}function Kn(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}var Zn=["friends_all","friends_request","friends_sent_request","people_may_know"];function $n(){Ue();var e=c.a.useState(0),t=Object(o.a)(e,2),n=t[0],i=t[1],s=Object(_.g)(),d=Object(_.i)();Object(a.useEffect)((function(){var e=d.friendsTab,t=Zn.indexOf(e);i(t=t<0?0:t)}),[d.friendsTab]);return Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(g.a,{p:2,children:Object(r.jsxs)(u.a,{container:!0,spacing:2,children:[Object(r.jsxs)(u.a,{item:!0,xs:9,children:[Object(r.jsx)(rn,{title:"Friends"}),Object(r.jsxs)(g.a,{mt:1,children:[Object(r.jsx)(h.a,{position:"static",color:"default",children:Object(r.jsxs)(Un.a,{value:n,onChange:function(e,t){i(t);var n=Zn[t];s.push("/".concat(n))},"aria-label":"simple tabs example",indicatorColor:"primary",className:"my-tabs",scrollButtons:"auto",variant:"scrollable",children:[Object(r.jsx)(qn.a,Object(se.a)({label:"All Friends"},Kn(0))),Object(r.jsx)(qn.a,Object(se.a)({label:"Friend Requests"},Kn(1))),Object(r.jsx)(qn.a,Object(se.a)({label:"Sent Requests"},Kn(2))),Object(r.jsx)(qn.a,Object(se.a)({label:"People you may know"},Kn(3)))]})}),Object(r.jsx)(Yn,{type:Zn[n]})]})]}),Object(r.jsxs)(u.a,{item:!0,xs:3,children:[Object(r.jsx)(cn,{})," "]})]})})})}function Qn(e){var t=Object.assign({},e),n=Object(I.c)(Q),c=Object(_.h)(),i=Object(_.g)();return Object(a.useEffect)((function(){if(n){var e=(c.state||{from:{pathname:"/"}}).from;i.replace(e)}}),[n,c.state,i]),Object(r.jsx)(_.b,Object(se.a)({},t))}function Xn(){window.addEventListener("scroll",(function(){window.scrollTo(0,0)}));var e=Object(ie.a)([Se]),t=Object(o.a)(e,1)[0],n=Object(I.c)(X)||{},c=Object(I.c)(Je),i=Object(I.b)();Object(a.useEffect)((function(){return V.onUpdateUser((function(e){i(ae(e))})),V.onFriendAccepted((function(e){V.emitUpdateUserById(n._id),i(Pt({message:L.format(Wt.friendAccepted,e.user.username),type:"info",open:!0}))})),V.onFriendRequested((function(e){V.emitUpdateUserById(n._id),i(Pt({message:L.format(Wt.friendRequested,e.user.username),type:"info",open:!0}))})),V.onFriendUnFriend((function(e){V.emitUpdateUserById(n._id)})),V.onFriendRequestCanceled((function(e){V.emitUpdateUserById(n._id)})),V.onFriendRejected((function(e){V.emitUpdateUserById(n._id)})),V.onNewMessageNotification((function(e){var t=e.message;e.conversationId!==c&&t.from._id!==n._id&&i(Pt({message:L.format(Wt.newMessage,t.from.username,t.text),type:"success",open:!0,timeout:2e3}))})),function(){V.off(H.updateUser),V.off(H.friendAccepted),V.off(H.friendRequested),V.off(H.friendUnfriend),V.off(H.friendRequestCanceled),V.off(H.friendRejected),V.off(H.newMessageNotification)}}),[n._id,c]),Object(a.useEffect)((function(){t.loggedUser&&i(J(t.loggedUser))}),[]);var s=Object(I.c)((function(e){return e.theme.type})),d=Object(In.a)({palette:{type:s}});return Object(r.jsx)(Fn.a,{theme:d,children:Object(r.jsx)(k.a,{children:Object(r.jsx)(bt.a,{style:{minHeight:"100vh"},children:Object(r.jsx)(u.a,{container:!0,spacing:2,children:Object(r.jsxs)(u.a,{item:!0,xs:12,children:[Object(r.jsx)(_e,{}),Object(r.jsxs)(_.d,{children:[Object(r.jsxs)(kn,{path:"/chat/:type(t|new)/:conversationId?",exact:!0,children:[" ",Object(r.jsx)(sn,{})," "]}),Object(r.jsxs)(kn,{path:"/:friendsTab(friends|friends_all|friends_request|friends_sent_request|people_may_know)",children:[Object(r.jsx)($n,{})," "]}),Object(r.jsx)(Qn,{path:"/login",exact:!0,component:mn}),Object(r.jsx)(Qn,{path:"/sign-up",exact:!0,component:yn}),Object(r.jsx)(_.a,{to:"/chat/new"})]}),Object(r.jsx)(_n,{})]})})})})})}var er=Object(B.a)({reducer:{chat:$e,notify:zt,auth:ce,sidebarConversations:ft,newChat:kt,theme:be}});s.a.render(Object(r.jsxs)(I.a,{store:er,children:[" ",Object(r.jsx)(Xn,{})," "]}),document.getElementById("root"))}},[[383,1,2]]]);
//# sourceMappingURL=main.5cf8f1ae.chunk.js.map