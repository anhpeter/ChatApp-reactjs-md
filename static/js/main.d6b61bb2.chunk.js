(this.webpackJsonpchat_app=this.webpackJsonpchat_app||[]).push([[0],{281:function(e,t,n){},282:function(e,t,n){},283:function(e,t,n){},382:function(e,t,n){},383:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),c=n.n(a),s=n(17),i=n.n(s),o=n(11),u=n(426),d=n(387),l=n(8),f=n(427),j=Object(l.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper)},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(u.a),p=Object(f.a)((function(e){return{root:{display:"flex","& > *":{margin:e.spacing(1)}}}}));function b(e){var t=e.name,n=e.picture,a=e.online,c=e.sizeInPixel,s=p(),i={width:"".concat(c,"px"),height:"".concat(c,"px")},o=Object(r.jsx)(d.a,{style:i,alt:t,src:n});return Object(r.jsx)("div",{className:s.root,children:a?Object(r.jsx)(j,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",children:o}):o})}var m,O=n(431),h=n(432),v=n(66),x=n(449),g=n(430),y=n(197),w=n.n(y),C={mainAppBar:"#main-app-bar"},S=n(22),_=n(29),k=n(7),I=n(39),U=n(5),F=n.n(U),q=n(9),R=n(18),N=n(21),B=n.n(N),T="http://localhost:3000",M="".concat(T,"/user"),A={findByUsername:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(M,"/getUserByUsername"),{params:{username:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findByUsernameAndPassword:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/getUserByUsernameAndPassword"),{username:t,password:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),createAccount:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/createAccount"),{username:t,password:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),findAllFriendsByUsername:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(M,"/getFriendsByUsername"),{params:{username:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findSentRequestFriendById:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(M,"/getSentRequestFriendById"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findStrangerByUsername:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(M,"/getStrangerByUsername"),{params:{username:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),sentFriendRequest:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/sentFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),unfriend:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/unfriend"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),cancelFriendRequest:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/cancelFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),deleteFriendRequest:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/deleteFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),confirmFriendRequest:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/confirmFriendRequest"),{id:t,friendId:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),findUsersByIds:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/getUsersByIds"),{ids:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findReceivers:function(){var e=Object(q.a)(F.a.mark((function e(t,n){var r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(M,"/getReceivers"),{username:t,exceptIds:n});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},E={ucFirst:function(e){if(e)return e.slice(0,1).toUpperCase()+e.slice(1)},titleCase:function(e){var t=this;if(e){var n=(e=e.trim()).split(" ");return(n.length>1?n.reduce((function(e){return t.ucFirst(e)+" "})):this.ucFirst(n[0])).trim()}},sleep:function(e){return new Promise((function(t){return setTimeout((function(){t()}),e)}))},isFn:function(e){return"function"===typeof e},format:function(e){for(var t=e,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(e&&r.length>0)for(var c in r)t=t.replace("{".concat(c,"}"),r[c]);return t},getArrayOfFieldValue:function(e,t,n){return e.map((function(e){return"string"===n?e[t].toString():e[t]}))},arrayDiff:function(e,t){var n,r,a=[];return e.length>t.length?(n=e,r=t):(n=t,r=e),n.forEach((function(e){-1===r.indexOf(e)&&a.push(e)})),a}},L=n(135),D={getUTCNow:function(){var e=new Date,t=e.getTime(),n=e.getTimezoneOffset();return t-(n*=6e4)},getCurrentTimeByUTCTime:function(e){var t=(new Date).getTimezoneOffset();return e+(t*=6e4)},getMessageTimeString:function(e){var t=new Date(e),n=new Date;return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()?L(e,"HH:MM"):L(e,"dd/mm/yyyy HH:MM")}},P=n(191),z=Object(P.io)(T,{"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]}),W={updateUser:"update-user",signIn:"sign-in",signOut:"sign-out",getOnlineUsers:"get-online-users",typing:"typing",stopTyping:"stop-typing",sendMessage:"send-message",receiveMessage:"receive-message",newMessageNotification:"new-message-notification",onlineUsers:"online-users",joinUsersToConversation:"join-users-to-conversation",joinRoom:"join-room",leaveRoom:"leave-room",acceptFriend:"accept-friend",addFriend:"add-friend",unfriend:"unfriend",cancelFriendRequest:"cancel-friend-request",deleteFriendRequest:"delete-friend-request",friendRequestCanceled:"friend-request-canceled",friendRejected:"friend-rejected",friendAccepted:"friend-accepted",friendRequested:"friend-requested",friendUnfriend:"friend-unfriend"},H={emitSignIn:function(e){z.emit(W.signIn,{user:e})},emitSignOut:function(e){z.emit(W.signOut,{user:e})},emitGetOnlineUsers:function(){z.emit(W.getOnlineUsers)},emitUpdateUserById:function(e){z.emit(W.updateUser,{id:e})},emitSendMessage:function(e,t,n){z.emit(W.sendMessage,{user:e,message:t,conversationId:n})},emitTyping:function(e,t){z.emit(W.typing,{user:e,conversationId:t})},emitStopTyping:function(e,t){z.emit(W.stopTyping,{username:e,conversationId:t})},emitJoinUsersToConversation:function(e,t){z.emit(W.joinUsersToConversation,{ids:e,conversationId:t})},emitJoinRoom:function(e){z.emit(W.joinRoom,{roomName:e})},emitLeaveRoom:function(e){z.emit(W.leaveRoom,{roomName:e})},emitAddFriend:function(e,t){z.emit(W.addFriend,{user:e,friendId:t})},emitAcceptFriend:function(e,t){z.emit(W.acceptFriend,{user:e,friendId:t})},emitUnfriend:function(e,t){z.emit(W.unfriend,{user:e,friendId:t})},emitCancelFriendRequest:function(e,t){z.emit(W.cancelFriendRequest,{user:e,friendId:t})},emitDeleteFriendRequest:function(e,t){z.emit(W.deleteFriendRequest,{user:e,friendId:t})},onUpdateUser:function(e){z.on(W.updateUser,(function(t){E.isFn(e)&&e(t)}))},onReceiveMessage:function(e){z.on(W.receiveMessage,(function(t){E.isFn(e)&&e(t)}))},onOnlineUsers:function(e){z.on(W.onlineUsers,(function(t){E.isFn(e)&&e(t)}))},onTyping:function(e){z.on(W.typing,(function(t){E.isFn(e)&&e(t)}))},onStopTyping:function(e){z.on(W.stopTyping,(function(t){E.isFn(e)&&e(t)}))},onNewMessageNotification:function(e){z.on(W.newMessageNotification,e)},onFriendAccepted:function(e){z.on(W.friendAccepted,e)},onFriendRequested:function(e){z.on(W.friendRequested,e)},onFriendUnFriend:function(e){z.on(W.friendUnfriend,e)},onFriendRequestCanceled:function(e){z.on(W.friendRequestCanceled,e)},onFriendRejected:function(e){z.on(W.friendRejected,e)},off:function(e){z.off(e)}},V=Object(R.b)("auth/login",function(){var e=Object(q.a)(F.a.mark((function e(t){var n,r,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,r=t.password,e.next=3,A.findByUsernameAndPassword(n,r);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),J=Object(R.b)("auth/sentFriendRequest",function(){var e=Object(q.a)(F.a.mark((function e(t){var n,r,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,r=t.friendId,e.next=3,A.sentFriendRequest(n,r);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G=function(e,t){H.emitSignIn(t.payload),e.user=t.payload,e.isLogged=!0},Y=Object(R.d)({name:"auth",initialState:{isLogged:!1,user:null,status:"idle",error:null},reducers:{login:function(e,t){G(e,t)},updateUser:function(e,t){e.user=t.payload},signOut:function(e){H.emitSignOut(e.user),e.user=null,e.isLogged=!1}},extraReducers:(m={},Object(I.a)(m,V.pending,(function(e,t){e.status="loading"})),Object(I.a)(m,V.fulfilled,(function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status?(G(e,{payload:r}),e.error=null):e.error="not found",e.status="succeeded"})),Object(I.a)(m,V.rejected,(function(e,t){e.error=t.error.message,e.status="failed"})),Object(I.a)(m,J.fulfilled,(function(e,t){})),m)}),K=function(e){return e.auth.error},Z=function(e){return e.auth.status},$=function(e){return e.auth.isLogged},Q=function(e){return e.auth.user},X=function(e){return e.auth.user._id},ee=Y.actions,te=ee.signOut,ne=ee.login,re=ee.updateUser,ae=Y.reducer,ce=n(451),se=n(15),ie=n(428),oe=n(193),ue=n.n(oe),de=n(192),le=n.n(de),fe=Object(R.d)({name:"theme",initialState:{type:"light"},reducers:{switchThemeType:function(e){e.type="light"===e.type?"dark":"light"}}}),je=fe.actions.switchThemeType,pe=fe.reducer;function be(){var e=Object(k.c)((function(e){return e.theme})),t=Object(k.b)(),n=Object(ce.a)(["theme"]),c=Object(o.a)(n,3),s=c[0],i=c[1];c[2];Object(a.useEffect)((function(){s.theme&&s.theme.type&&s.theme.type!==e.type&&t(je())}));return Object(r.jsx)(ie.a,{"aria-label":"Day / night toggle",onClick:function(){var n=Object(se.a)(Object(se.a)({},e),{},{type:"light"===e.type?"dark":"light"});i("theme",JSON.stringify(n)),t(je())},color:"inherit",children:"light"===e.type?Object(r.jsx)(le.a,{}):Object(r.jsx)(ue.a,{})})}var me=n(64);Object(l.a)((function(e){return{badge:{right:-3,top:5,border:"1px solid white",padding:"0 4px"}}}))(u.a);var Oe=n(196),he=n.n(Oe),ve=n(195),xe=n.n(ve),ge=n(453),ye=n(457);function we(e){var t=e.children,n=Object(me.a)(e,["children"]);return Object(r.jsx)(_.b,Object(se.a)(Object(se.a)({},n),{},{style:{all:"unset"},children:t}))}function Ce(){Object(S.g)();return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(ge.a,{xsDown:!0,children:Object(r.jsx)(we,{to:"/chat/new",children:Object(r.jsx)(ye.a,{title:"Chat",children:Object(r.jsx)(ie.a,{color:"inherit",children:Object(r.jsx)(xe.a,{})})})})}),Object(r.jsx)(we,{to:"/friends",children:Object(r.jsx)(ye.a,{title:"Friends",children:Object(r.jsx)(ie.a,{color:"inherit",children:Object(r.jsx)(he.a,{})})})})]})}var Se="loggedUser";function _e(e){var t=Object(ce.a)(Se),n=Object(o.a)(t,3),a=(n[0],n[1],n[2]),c=Object(k.c)(Q),s=Object(k.b)(),i=Object(k.c)($),u=Object(k.c)(Z),d=Object(S.h)().pathname,l=Object(S.g)(),f=Object(r.jsxs)(x.a,{display:"flex",alignItems:"center",justifyContent:"center",children:[Object(r.jsx)(x.a,{mr:4,children:i?Object(r.jsx)(Ce,{}):null}),Object(r.jsx)(be,{}),i?Object(r.jsx)(b,{name:c.name,single:c.single,picture:c.picture}):null,Object(r.jsx)(g.a,{disabled:"/login"===d,startIcon:i?null:Object(r.jsx)(w.a,{}),color:"inherit",onClick:function(){a(Se),s(te()),l.push("/")},children:Object(r.jsx)(v.a,{children:i?"Sign out":"Sign in"})})]});return Object(r.jsx)(O.a,{className:"header",position:"static",color:"primary",id:C.mainAppBar,children:Object(r.jsxs)(h.a,{style:{display:"flex",justifyContent:"space-between"},children:[Object(r.jsx)(v.a,{variant:"h6",children:Object(r.jsx)(_.b,{to:"/chat",color:"inherit",style:{color:"white",textDecoration:"none"},children:"Messenger"})}),"loading"!==u?f:null]})})}var ke=n(438),Ie=(n(433),n(448));var Ue=n(456),Fe="#F0F2F5",qe=Object(f.a)((function(e){return Object(Ue.a)({table:{minWidth:650},chatSection:{width:"100%",height:"400px",overflow:"auto"},headBG:{backgroundColor:"#e0e0e0"},borderRight500:{borderRight:"1px solid #e0e0e0"},borderLeft500:{borderLeft:"1px solid #e0e0e0"},messageArea:{height:"70vh",overflowY:"auto"},RoundLightGrayInputStyle:{paddingLeft:"10px",paddingRight:"10px",backgroundColor:Fe,borderRadius:"50px"},buttonStyle:{textTransform:"none"},flexCenterVerticalStyle:{display:"flex",alignItems:"center"},flexCenterStyle:{display:"flex",alignItems:"center",justifyContent:"center"},defaultContainerPaddingStyle:{root:{"& > *":{padding:e.spacing(2)}}}})})),Re=n(434),Ne=n(385),Be=n(437),Te=n(435);function Me(e){var t=e.items,n=e.max,a=void 0===n?2:n,c=t.slice(0,a).map((function(e,t){return Object(r.jsx)(d.a,{alt:e.name,src:e.src},t)}));return Object(r.jsx)(Te.a,{max:a,spacing:"small",children:c})}var Ae=n(436),Ee="".concat(T,"/conversation"),Le={findConversationById:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(Ee,"/getConversationById"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findConversationByMemberIds:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(Ee,"/getConversationByMemberIds"),{ids:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findSidebarConversationById:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(Ee,"/getSidebarConversationById"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),listConversationsForListDisplay:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(Ee,"/listConversationsForListDisplay"),{params:{id:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),findConversationInfoByUserIdsOrCreateIfNotExist:function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(Ee,"/getConversationInfoByUserIdsOrCreateIfNotExist"),{ids:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getHomeConversation:function(){var e=Object(q.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat(Ee,"/home"));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),createConversationWithMemberIds:function(){var e=Object(q.a)(F.a.mark((function e(t){var n,r,a=arguments;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,e.next=3,B.a.post("".concat(Ee,"/createConversationWithMemberIds"),{ids:t,messageParams:n});case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},De=Object(R.b)("chat/conversation",function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationByMemberIds(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Pe=Object(R.b)("chat/conversation",function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationById(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ze=(Object(R.b)("chat/conversation",function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationByUserIdsOrCreateIfNotExist(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(R.b)("chat/conversation",Object(q.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.getHomeConversation();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))),Object(R.d)({name:"chat",initialState:{conversation:{},sidebarConversations:[],status:"idle",error:null},reducers:{appendMessage:function(e,t){e.conversation.messages.push(t.payload)},reset:function(e,t){e.conversation={},e.status="idle",e.error=null}},extraReducers:{"chat/conversation/pending":function(e,t){e.status="loading"},"chat/conversation/fulfilled":function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status?(e.conversation=r,e.error=null):e.error="not found",e.status="succeeded"},"chat/conversation/rejected":function(e,t){e.error=t.error.message,e.status="failed"}}})),We=function(e){return e.chat.status},He=function(e){return e.chat.conversation},Ve=function(e){return e.chat.conversation.members},Je=function(e){return e.chat.conversation._id},Ge=function(e){return e.chat.conversation.messages||[]},Ye=ze.actions,Ke=Ye.reset,Ze=Ye.appendMessage,$e=ze.reducer;function Qe(e){var t=e.children,n=e.item,a=Object(me.a)(e,["children","item"]),c=Object(S.g)(),s=Object(k.c)(Q)||{},i=Object(k.c)(Ve),o=function(){var e=Object(q.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=function(){var e=Object(q.a)(F.a.mark((function e(){var t,r,a,i,o,u,d;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.findConversationInfoByUserIdsOrCreateIfNotExist([s._id,n._id]);case 2:t=e.sent,r=t.status,a=t.payload,"succeeded"===r&&(i=a.members,o=a.isNew,u=a._id,o&&H.emitJoinUsersToConversation(i,u),d=t.payload._id,c.push("/chat/t/".concat(d)));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i){e.next=6;break}return e.next=4,t();case 4:e.next=9;break;case 6:if(!(E.arrayDiff(i,[s._id,n._id]).length>0)){e.next=9;break}return e.next=9,t();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)(x.a,Object(se.a)(Object(se.a)({},a),{},{onClick:o,children:[" ",t]}))}var Xe,et=Object(f.a)({truncateListItemStyle:{"& > p":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),tt=function(e){var t=e.items;return t=t.map((function(e){return{name:e.username,src:e.picture}})),Object(r.jsx)(Me,{items:t})};function nt(e){var t,n=e.item,a=e.online,c=e.icon,s=et(),i=Object(k.c)(Q),o=Object(k.c)(Je),u=n.members,l=u.filter((function(e){return e._id!==i._id})),f=null;if(t=2===u.length?l[0].username:"".concat(l[0].username," and ").concat(l.length-1," others"),n.lastMessage){var j=n.lastMessage?n.lastMessage.from._id===i._id?"you: ":l.length>1?"".concat(n.lastMessage.from.username,": "):null:null;f=null!==j?"".concat(j," ").concat(n.lastMessage.text):n.lastMessage.text}return Object(r.jsx)(we,{to:"/chat/t/".concat(n._id),children:Object(r.jsxs)(Ne.a,{button:!0,selected:o===n._id,children:[Object(r.jsx)(Ae.a,{style:{width:"90px"},children:c?Object(r.jsxs)(d.a,{children:[" ",c," "]}):2===u.length?Object(r.jsx)(b,{online:a,name:t,single:!0,picture:l[0].picture}):Object(r.jsx)(tt,{items:l})}),Object(r.jsx)(ge.a,{xsDown:!0,children:Object(r.jsx)(Be.a,{className:s.truncateListItemStyle,primary:t,secondary:f})})]})})}var rt=Object(R.b)("sidebarConversations/fetchConversations",function(){var e=Object(q.a)(F.a.mark((function e(t){var n,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.next=3,Le.listConversationsForListDisplay(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),at=Object(R.b)("sidebarConversations/fetchAndPrependConversationById",function(){var e=Object(q.a)(F.a.mark((function e(t){var n,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.next=3,Le.findSidebarConversationById(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ct=Object(R.c)({selectId:function(e){return e._id},sortComparer:function(e,t){return-(e.lastMessage.time-t.lastMessage.time)}}),st=ct.getInitialState({status:"idle",error:null}),it=Object(R.d)({name:"sidebarConversations",initialState:st,reducers:{updateLastMessage:function(e,t){var n=t.payload,r=n.id,a=n.message,c=e.entities[r];c?(c.lastMessage=a,ct.upsertOne(e,c)):at({id:r})}},extraReducers:(Xe={},Object(I.a)(Xe,at.fulfilled,(function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status&&ct.upsertOne(e,r)})),Object(I.a)(Xe,rt.pending,(function(e,t){e.status="loading"})),Object(I.a)(Xe,rt.fulfilled,(function(e,t){var n=t.payload,r=n.payload;"succeeded"===n.status?(ct.upsertMany(e,r),e.error=null):e.error="not found",e.status="succeeded"})),Xe)}),ot=ct.getSelectors((function(e){return e.sidebarConversations})),ut=ot.selectAll,dt=(ot.selectById,ot.selectIds),lt=it.actions.updateLastMessage,ft=it.reducer;function jt(){qe();var e=Object(k.b)(),t=Object(k.c)(ut),n=Object(k.c)(Q),c=Object(k.c)(dt),s=Object(k.c)(Je);Object(a.useEffect)((function(){e(rt({id:n._id}))}),[]),Object(a.useEffect)((function(){var t=function(t){var n=t.message,r=t.conversationId;c.indexOf(r)>-1?e(lt({id:r,message:n})):e(at({id:r}))};return H.onNewMessageNotification(t),function(){z.removeListener(W.newMessageNotification,t)}}),[s,c]);var i=t.map((function(e,t){return Object(r.jsx)(nt,{item:e},t)}));return Object(r.jsx)(Re.a,{className:"left-sidebar custom-scrollbar",children:i})}var pt=n(208),bt={enabled:!1,receivers:[]},mt=Object(R.d)({name:"newChat",initialState:bt,reducers:{setEnabled:function(e,t){e.enabled=t.payload},removeReceiverById:function(e,t){e.receivers=e.receivers.filter((function(e){return e._id!==t.payload}))},appendReceiver:function(e,t){e.receivers.push(t.payload)},removeLastReceiver:function(e,t){e.receivers.length>0&&(e.receivers=e.receivers.slice(0,-1))},reset:function(e,t){e.enabled=bt.enabled,e.receivers=bt.receivers}}}),Ot=function(e){return e.newChat.receivers},ht=function(e){return e.newChat.enabled},vt=function(e){return 1===e.newChat.receivers.length?e.newChat.receivers[0]:null},xt=mt.actions,gt=xt.removeReceiverById,yt=xt.appendReceiver,wt=xt.removeLastReceiver,Ct=xt.setEnabled,St=xt.reset,_t=mt.reducer;function kt(){return Object(r.jsx)(v.a,{align:"center",className:"text-muted",children:"Loading..."})}function It(e){var t=e.notShowAvatar,n=e.ownMessage,a=e.time,c=e.user,s=e.message,i=t?null:Object(r.jsx)(b,{sizeInPixel:20,name:c.username,picture:c.picture}),o=n?"right":"left",u=n?"flex-end":"flex-start",d=n?"bottom-start":"bottom-end";return Object(r.jsx)(Ne.a,{children:Object(r.jsxs)(x.a,{width:"100%",style:{display:"flex",justifyContent:u,alignItems:"flex-end"},children:[n?null:i,Object(r.jsx)(x.a,{className:"message ".concat(o,"-message ").concat(!n&&t?"ml-avatar":""),children:Object(r.jsx)(ye.a,{title:D.getMessageTimeString(D.getCurrentTimeByUTCTime(a)),placement:d,children:Object(r.jsx)(Be.a,{align:o,primary:s})})})]})},"1")}function Ut(e){var t,n=e.username,a=e.type,c=Object(r.jsx)(v.a,{component:"span",color:"primary",children:n});switch(a){case"welcome-current-user-notification":t="Welcome to the chat room.";break;case"welcome-other-user-notification":t=Object(r.jsxs)("span",{children:[c," has joined the chat."]});break;case"user-left-notification":t=Object(r.jsxs)("span",{children:[c," has left the chat."]});break;default:t=""}return Object(r.jsx)(v.a,{align:"center",className:"text-muted",children:t})}n(281);var Ft=Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(x.a,{mt:4,children:Object(r.jsx)(v.a,{className:"text-muted",align:"center",children:"Let's start a conversation."})})});function qt(e){var t=e.messages,n=(qe(),Object(k.c)(Q)),c=Object(k.c)(ht),s=t.map((function(e,a){if(e.from){var c=!1;if(a<t.length-1){var s=t[a+1];c="message"===s.type&&s.from.username===e.from.username}return Object(r.jsx)(It,{notShowAvatar:c,ownMessage:e.from.username===n.username,user:e.from,message:e.text,time:e.time},a)}return Object(r.jsx)(Ut,{username:e.user.username,type:e.type},a)}));return Object(a.useEffect)((function(){!function(){var e=document.getElementsByClassName("chat-box-messages-wrapper");e[0].scrollTop=e[0].scrollHeight}()}),[t]),Object(r.jsx)(Re.a,{className:"chat-box-messages-wrapper custom-scrollbar",style:{top:c?"57px":"0"},children:s.length>0?s:c?null:Ft})}var Rt,Nt=n(439),Bt=Object(R.d)({name:"notify",initialState:{message:"",type:"",open:!1,timeout:4e3},reducers:{setNotify:function(e,t){var n=t.payload,r=n.message,a=n.type,c=n.open,s=n.timeout;c&&(e.message=r||"",e.type=a||"",e.timeout=s||6e3),e.open=c||!1}}}),Tt=function(e){return e.notify.open},Mt=function(e){return e.notify.message},At=function(e){return e.notify.type},Et=function(e){return e.notify.timeout},Lt=Bt.actions.setNotify,Dt=Bt.reducer,Pt={invalid:"{0} invalid",fail:"Something went wrong",welcomeNewAccount:"Hello {0}, let's start a chat with your fiends!",PleaseTypeMessage:"Please type some message to send!",PleaseChooseReceiver:"Please choose receiver!",newMessage:"{0}: {1}",friendRequested:"{0} sent you a friend request.",unfriended:"{0} unfriended you.",friendAccepted:"{0} accepted your friend request."};function zt(){var e=Object(a.useState)(""),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!1),i=Object(o.a)(s,2),u=i[0],d=i[1],l=Object(k.b)(),f=Object(S.g)(),j=Object(k.c)(Q),p=Object(k.c)(He),b=Object(k.c)(Ot),m=Object(k.c)(ht),O=function(){H.emitSendMessage(j,n,p._id),c(""),m&&f.push("/chat/t/".concat(p._id))},h=function(){var e=Object(q.a)(F.a.mark((function e(){var t,r,a,s;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.getArrayOfFieldValue(b,"_id").concat(j._id),e.next=3,Le.createConversationWithMemberIds(t);case 3:r=e.sent,a=r.status,s=r.payload,"succeeded"===a&&(H.emitJoinUsersToConversation(s.members,s._id),H.emitSendMessage(j,n,s._id),c(""),f.push("/chat/t/".concat(s._id)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){u&&(H.emitStopTyping(j.username,p._id),d(!1))};return Object(r.jsx)("form",{onSubmit:function(e){!function(e){e.preventDefault(),""===n.trim()?l(Lt({message:Pt.PleaseTypeMessage,open:!0,timeout:2e3})):p._id?O():m&&b.length>0?h():l(Lt({message:Pt.PleaseChooseReceiver,open:!0,timeout:2e3}))}(e)},children:Object(r.jsxs)(ke.a,{container:!0,children:[Object(r.jsx)(ke.a,{item:!0,xs:10,md:11,children:Object(r.jsx)(Ie.a,{autoFocus:!0,inputProps:{autoComplete:"off"},value:n,id:"outlined-basic-email",fullWidth:!0,onChange:function(e){c(e.target.value)},onKeyUp:function(e){13!==e.which?n.length>3&&(u||""===n.trim()||H.emitTyping(j,p._id),d(!0),clearTimeout(Rt),Rt=setTimeout((function(){v()}),2e3)):v()},onBlur:function(){v()}})}),Object(r.jsx)(ke.a,{item:!0,xs:2,md:1,align:"center",children:Object(r.jsxs)(ie.a,{color:"primary",type:"submit",children:[" ",Object(r.jsx)(Nt.a,{})," "]})})]})})}function Wt(e){var t=e.type;return Object(r.jsx)(pt.a,{style:{boxShadow:"none"},className:"sending-message-bar-wrapper",children:Object(r.jsx)(zt,{type:t})})}function Ht(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1];Object(a.useEffect)((function(){return H.onTyping((function(e){c(n.concat(e.user))})),H.onStopTyping((function(e){c(n.filter((function(t){return t.username!==e.username})))})),function(){z.off(W.typing),z.off(W.stopTyping)}}));var s=n.map((function(e){return Object(r.jsx)("div",{children:Object(r.jsxs)("div",{style:{display:"flex",alignItems:"flex-start"},children:[Object(r.jsx)("span",{children:Object(r.jsx)(b,{name:e.username,picture:e.picture,children:" "})}),Object(r.jsx)("img",{className:"typing-icon",src:"".concat("/chat","/images/icons/typing-icon.gif"),alt:"typing"})]})},e._id)}));return Object(r.jsx)(pt.a,{elevation:0,style:{minWidth:"200px"},children:s.length>0?s:null})}function Vt(){var e=Object(k.c)(We),t=Object(k.c)(Ge),n=Object(k.c)(He),c=Object(k.b)(),s=Object(S.g)(),i=Object(k.c)(X),o=Object(S.i)().conversationId,u=Object(k.c)(vt)||{},d=Object(k.c)(ht);return Object(a.useEffect)((function(){d&&(u._id?c(De(["".concat(i),"".concat(u._id)])):c(Ke()))}),[u._id,d]),Object(a.useEffect)((function(){return"succeeded"===e&&(n._id?H.emitJoinRoom("".concat(n._id,"_current")):s.replace("/chat/new")),function(){n._id&&H.emitLeaveRoom("".concat(n._id,"_current"))}}),[e,n._id]),Object(a.useEffect)((function(){o&&c(Pe(o))}),[o]),Object(a.useEffect)((function(){return function(){c(Ke())}}),[]),Object(a.useEffect)((function(){return H.onReceiveMessage((function(e){var t=e.conversationId,r=e.message;if(t===n._id){var a=Object(se.a)({type:"message"},r);c(Ze(a))}})),function(){H.off(W.receiveMessage)}}),[t,n._id]),Object(r.jsx)(x.a,{children:"loading"===e?Object(r.jsx)(kt,{}):Object(r.jsx)(qt,{messages:t})})}var Jt,Gt=n(452),Yt=n(198),Kt=n.n(Yt);n(282),n(283);function Zt(e){var t=e.items,n=void 0===t?[]:t,a=e.onItemClick;return Object(r.jsx)(Re.a,{className:"suggestion-receiver-list",dense:!1,children:function(e){return e.map((function(e){return Object(r.jsxs)(Ne.a,{button:!0,onClick:function(){a(e)},children:[Object(r.jsx)(Ae.a,{children:Object(r.jsx)(d.a,{src:e.picture,children:" "})}),Object(r.jsx)(Be.a,{primary:e.username,secondary:null})]},e._id)}))}(n)})}var $t=function(e){var t=e.items,n=e.onCloseClick;return t.map((function(e){return Object(r.jsxs)(Gt.a,{className:"selected-receiver",severity:"info",icon:!1,action:Object(r.jsx)(ie.a,{"aria-label":"close",color:"inherit",size:"small",onClick:function(){n(e)},children:Object(r.jsx)(Kt.a,{fontSize:"inherit"})}),children:[" ",e.username]},e._id)}))};function Qt(e){var t=e.onFriendIdSelected,n=Object(k.b)(),c=Object(a.useState)(!0),s=Object(o.a)(c,2),i=s[0],u=s[1],d=Object(a.useState)([]),l=Object(o.a)(d,2),f=l[0],j=l[1],p=Object(a.useState)(""),b=Object(o.a)(p,2),m=b[0],O=b[1],h=Object(a.useState)(""),g=Object(o.a)(h,2),y=g[0],w=g[1],C=Object(a.useRef)(null),S=Object(k.c)(X),_=Object(k.c)(Ot);Object(a.useEffect)((function(){u(!0);var e=function(){var e=Object(q.a)(F.a.mark((function e(){var t,n,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.findReceivers(y,E.getArrayOfFieldValue(_,"_id").concat(S));case 2:t=e.sent,n=t.status,r=t.payload,"succeeded"===n&&i&&j(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return""!==y.trim()&&e(),function(){u(!1)}}),[y,_,S]),Object(a.useEffect)((function(){1===_.length?t(_[0]._id):t(null)}),[_]);var I=function(e,t,r){8===e.which&&""===t.trim()&&""===r.trim()&&n(wt())};return Object(r.jsxs)(x.a,{className:"receiver-wrapper",children:[Object(r.jsx)(v.a,{className:"receiver-label",children:"To: "}),Object(r.jsxs)(x.a,{className:"receiver-container",display:"inline-block",children:[Object(r.jsx)($t,{items:_,onCloseClick:function(e){n(gt(e._id))}}),Object(r.jsxs)(x.a,{className:"receiver-input-container",children:[Object(r.jsx)(Ie.a,{placeholder:"Receiver",ref:C,className:"receiver-input",autoFocus:!0,onKeyUp:function(e){var t=e.target.value;I(e,m,t)},onChange:function(e){var t=e.target.value;O(t),clearTimeout(Jt),Jt=setTimeout((function(){w(t)}),500)},onBlur:function(e){var t=e.target.value;I(e,m,t)},value:m}),f.length>0?Object(r.jsx)(Zt,{items:f,onItemClick:function(e){n(yt(e)),O(""),w(""),j([]),C.current.querySelector("input").focus()}}):null]})]})]})}function Xt(){var e=Object(a.useState)(null),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(k.b)();return Object(a.useEffect)((function(){return s(Ct(!0)),function(){s(St())}}),[]),Object(r.jsxs)(x.a,{position:"relative",children:[Object(r.jsx)(pt.a,{style:{position:"absolute",zIndex:"1000",width:"100%",boxShadow:"none"},children:Object(r.jsx)(Qt,{onFriendIdSelected:function(e){c(e)}})}),Object(r.jsx)(x.a,{children:Object(r.jsx)(Vt,{friendId:n,type:"temp"})})]})}function en(e){var t=e.children,n=Object(a.useState)(!0),s=Object(o.a)(n,1)[0],i=Object(S.i)(),u=Object(S.g)(),d=Object(a.useState)(null),l=Object(o.a)(d,2),f=l[0],j=l[1],p=Object(k.c)(We);Object(a.useEffect)((function(){var e=i.type,t=i.conversationId;if(e)switch(e){case"t":t||u.replace("/chat"),j("chat");break;case"new":t&&u.replace("/chat/new"),j("new")}else j("chat");return function(){}}),[i]);var b=Object(r.jsxs)(x.a,{className:"chat-box-wrapper",children:["chat"===f?Object(r.jsx)(Vt,{}):Object(r.jsx)(Xt,{}),Object(r.jsx)("div",{style:{position:"absolute",bottom:"100px",left:"5px",width:"100%"},children:Object(r.jsx)(Ht,{})}),Object(r.jsx)(x.a,{display:"loading"===p?"none":"unset",children:Object(r.jsx)(Wt,{})})]});return Object(r.jsxs)(c.a.Fragment,{children:[" ",s?b:t," "]})}function tn(e){var t=e.title;return Object(r.jsx)(v.a,{variant:"h5",children:t})}var nn=Object(f.a)((function(e){return{root:{width:"100%"}}}));function rn(e){e.item;var t=nn(),n=Object(a.useState)([]),c=Object(o.a)(n,2),s=c[0],i=c[1],u=Object(a.useState)(!1),d=Object(o.a)(u,2),l=d[0],f=d[1],j=Object(k.c)(Q)||{};Object(a.useEffect)((function(){return setTimeout((function(){f(!0)}),500),H.emitGetOnlineUsers(),H.onOnlineUsers((function(e){i(e)})),function(){z.off(W.onlineUsers)}}),[]);var p=s.filter((function(e){return e.username!==j.username})).map((function(e){return Object(r.jsxs)(Qe,{button:!0,component:Ne.a,item:e,children:[Object(r.jsx)(Ae.a,{children:Object(r.jsx)(b,{online:!0,name:e.name,single:e.single,picture:e.picture})}),Object(r.jsx)(ge.a,{smDown:!0,children:Object(r.jsx)(Be.a,{primary:e.username})})]},e._id)})),m=Object(r.jsx)(v.a,{className:"text-muted",align:"center",children:"No online users"});return Object(r.jsxs)(x.a,{className:"online-users-wrapper",children:[Object(r.jsx)(x.a,{p:2,className:"title",children:Object(r.jsx)(tn,{title:"Online"})}),Object(r.jsx)(Re.a,{className:"".concat(t.root," online-users-list"),children:l?p.length>0?p:m:null})]})}function an(){var e=qe(),t=Object(a.useState)(0),n=Object(o.a)(t,2),c=n[0];n[1],"calc(100vh - ".concat(c,"px)");return Object(a.useEffect)((function(){}),[]),Object(r.jsx)(x.a,{className:"main-content",p:2,children:Object(r.jsxs)(ke.a,{style:{height:"100%"},container:!0,children:[Object(r.jsx)(ke.a,{style:{height:"100%",padding:0},item:!0,xs:3,className:"".concat(e.borderRight500),children:Object(r.jsx)(jt,{})}),Object(r.jsx)(ke.a,{style:{height:"100%"},item:!0,xs:9,md:7,children:Object(r.jsx)(en,{children:"Loading..."})}),Object(r.jsx)(ge.a,{smDown:!0,children:Object(r.jsx)(ke.a,{style:{height:"100%",padding:0},item:!0,xs:!1,md:2,className:"".concat(e.borderLeft500," "),children:Object(r.jsx)(rn,{})})})]})})}var cn=n(441),sn=n(112),on=n.n(sn),un=n(440),dn=n(113),ln=n(40),fn={required:"{0} required",lengthGreater:"{0} must greater than {1} characters",noSpecialCharacter:"{0} must not contain special characters",unique:"{0} must be unique",match:"{0} must match"},jn=Object(f.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function pn(){var e=Object(k.b)(),t=Object(a.useState)(!1),n=Object(o.a)(t,2),c=n[0],s=n[1],i=Object(k.c)($),u=Object(ce.a)([Se]),l=Object(o.a)(u,2),f=(l[0],l[1]),j=Object(k.c)(Z),p=Object(k.c)(K),b=jn();if(c)"succeeded"===j&&p&&e(Lt({message:"Login unsuccessfully",type:"error",open:!0}));else if("loading"===j)return null;var m=Object(r.jsxs)(un.a,{component:"main",maxWidth:"xs",children:[Object(r.jsx)(cn.a,{}),Object(r.jsxs)("div",{className:b.paper,children:[Object(r.jsx)(d.a,{className:b.avatar,children:Object(r.jsx)(on.a,{})}),Object(r.jsx)(v.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(r.jsx)(dn.a,{initialValues:{username:"",password:"",passwordConfirmation:""},validationSchema:ln.a({username:ln.c().required(E.format(fn.required,"Username")),password:ln.c().required(E.format(fn.required,"Password"))}),onSubmit:function(){var t=Object(q.a)(F.a.mark((function t(n,r){var a,c,i;return F.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.setSubmitting,a=n.username,c=n.password,i={username:a,password:c},s(!0),e(V(i)),f(Se,i);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),children:function(e){var t=e.values,n=e.errors,a=e.touched,c=e.handleChange,s=e.handleBlur,i=e.handleSubmit,o=e.isSubmitting,u=e.isValid,d=e.dirty,l={};for(var f in n)l[f]=null!=n[f]&&a[f];var j=function(e,r){return{fullWidth:!0,margin:"normal",placeholder:r=r||E.ucFirst(e),variant:"outlined",name:e,onChange:c,onBlur:s,value:t[r],label:r,error:l[e],helperText:l[e]?n[e]:null}};return Object(r.jsxs)("form",{onSubmit:i,noValidate:!0,autoComplete:"off",children:[Object(r.jsx)(Ie.a,Object(se.a)({autoFocus:!0,type:"text"},j("username"))),Object(r.jsx)(Ie.a,Object(se.a)({type:"password"},j("password"))),Object(r.jsx)(x.a,{children:Object(r.jsx)(g.a,{disabled:o||!u||!d,type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:" Sign In"})}),Object(r.jsx)(we,{to:"/sign-up",children:Object(r.jsx)(v.a,{color:"primary",style:{cursor:"pointer"},children:"Create an account"})})]})}})]})]});return i?null:m}var bn=function(){var e=Object(q.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,A.findByUsername(t);case 3:return n=e.sent,e.abrupt("return","succeeded"===n.status);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),mn=function(e,t){return!!e&&e.length>=t},On=function(e){return!!e&&/^[a-zA-Z0-9]+$/.test(e)},hn={username:function(e,t,n){var r="Username";return ln.c().required(E.format(fn.required,r)).test("length",E.format(fn.lengthGreater,r,4),(function(e,t){return mn(e,4)})).test("specialCharacter",E.format(fn.noSpecialCharacter,r),(function(e,t){return On(e)})).test("usernameExist",E.format(fn.unique,r),function(){var r=Object(q.a)(F.a.mark((function r(a,c){return F.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!mn(a,4)||!On(a)){r.next=6;break}if(a===e.value){r.next=6;break}if(clearTimeout(n),a){r.next=5;break}return r.abrupt("return",!0);case 5:return r.abrupt("return",new Promise((function(e,r){n=setTimeout(Object(q.a)(F.a.mark((function n(){var r;return F.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,bn(a);case 2:r=n.sent,t({value:a,unique:!r}),e(!r);case 5:case"end":return n.stop()}}),n)}))),500)})));case 6:return r.abrupt("return",e.unique);case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())},password:function(){var e="Password";return ln.c().required(E.format(fn.required,e)).matches(/[a-zA-Z0-9]{3,}/,E.format(fn.lengthGreater,e))},passwordConfirmation:function(){var e="Password confirmation";return ln.c().required(E.format(fn.required,e)).oneOf([ln.b("password")],E.format(fn.match,e))}},vn=Object(f.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)}}}));function xn(){var e=Object(k.b)(),t=Object(a.useState)({value:"",unique:!1}),n=Object(o.a)(t,2),c=n[0],s=n[1],i=Object(k.c)($),u=Object(k.c)(Z),l=vn();return"loading"===u||i?null:Object(r.jsxs)(un.a,{component:"main",maxWidth:"xs",children:[Object(r.jsx)(cn.a,{}),Object(r.jsxs)("div",{className:l.paper,children:[Object(r.jsx)(d.a,{className:l.avatar,children:Object(r.jsx)(on.a,{})}),Object(r.jsx)(v.a,{component:"h1",variant:"h5",children:"Sign Up"}),Object(r.jsx)(dn.a,{initialValues:{username:"",password:"",passwordConfirmation:""},validationSchema:ln.a({username:hn.username(c,s,undefined),password:hn.password(),passwordConfirmation:hn.passwordConfirmation()}),onSubmit:function(){var t=Object(q.a)(F.a.mark((function t(n,r){var a,c,s,i,o;return F.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.setSubmitting,c=n.username,s=n.password,t.next=4,A.createAccount(c,s);case 4:"succeeded"===(i=t.sent).status?(o=i.payload,e(Lt({message:E.format(Pt.welcomeNewAccount,o.username)})),e(ne(o))):a(!1);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),children:function(e){var t=e.values,n=e.errors,a=e.touched,c=e.handleChange,s=e.handleBlur,i=e.handleSubmit,o=e.isSubmitting,u=e.isValid,d=e.dirty,l={};for(var f in n)l[f]=null!=n[f]&&a[f];var j=function(e,r){return{fullWidth:!0,margin:"normal",placeholder:r=r||E.ucFirst(e),variant:"outlined",name:e,onChange:c,onBlur:s,value:t[r],label:r,error:l[e],helperText:l[e]?n[e]:null}};return Object(r.jsxs)("form",{onSubmit:i,noValidate:!0,autoComplete:"off",children:[Object(r.jsx)(Ie.a,Object(se.a)({type:"text"},j("username"))),Object(r.jsx)(Ie.a,Object(se.a)({type:"password"},j("password"))),Object(r.jsx)(Ie.a,Object(se.a)({type:"password"},j("passwordConfirmation","Password confirmation"))),Object(r.jsx)(x.a,{children:Object(r.jsx)(g.a,{disabled:o||!u||!d,type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:" Sign Up "})}),Object(r.jsx)(we,{to:"/signin",children:Object(r.jsx)(v.a,{color:"primary",style:{cursor:"pointer"},children:"Have an account?"})})]})}})]})]})}var gn=n(455);function yn(e){return Object(r.jsx)(Gt.a,Object(se.a)({elevation:6,variant:"filled"},e))}var wn=Object(f.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}}));function Cn(){var e=wn(),t=Object(k.b)(),n=Object(k.c)(Tt),a=Object(k.c)(Mt),c=Object(k.c)(At),s=Object(k.c)(Et),i=function(e,n){"clickaway"!==n&&t(Lt({open:!1}))};return Object(r.jsx)("div",{className:e.root,children:a?Object(r.jsx)(gn.a,{open:n,autoHideDuration:s,onClose:i,anchorOrigin:{horizontal:"right",vertical:"top"},message:a,children:""!==c?Object(r.jsx)(yn,{onClose:i,severity:c,children:a}):null}):""})}function Sn(e){var t=e.children,n=Object(me.a)(e,["children"]),a=Object(k.c)($);return Object(r.jsx)(S.b,Object(se.a)(Object(se.a)({},n),{},{render:function(e){var n=e.location;return a?t:Object(r.jsx)(S.a,{to:{pathname:"/login",state:{from:n}}})}}))}var _n=n(204),kn=n(447),In=(n(382),n(450)),Un=n(446),Fn=n(443),qn=n(444),Rn=n(445);function Nn(e){var t=e.item,n=qe(),a=Object(k.c)(Q),s=function(){var e=Object(q.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.cancelFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(H.emitUpdateUserById(a._id),H.emitCancelFriendRequest(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(g.a,{onClick:s,variant:"contained",size:"small",className:n.buttonStyle,children:"Cancel request"})})}function Bn(e){var t=e.item,n=qe(),a=Object(k.c)(Q),s=function(){var e=Object(q.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.confirmFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(H.emitUpdateUserById(a._id),H.emitAcceptFriend(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){var e=Object(q.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.deleteFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(H.emitUpdateUserById(a._id),H.emitDeleteFriendRequest(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)(c.a.Fragment,{children:[Object(r.jsx)(g.a,{onClick:s,color:"primary",variant:"contained",size:"small",className:n.buttonStyle,children:"Confirm"}),Object(r.jsx)(g.a,{onClick:i,variant:"contained",size:"small",className:n.buttonStyle,children:"Delete"})]})}function Tn(e){var t=e.item,n=qe(),a=Object(k.c)(Q),s=function(){var e=Object(q.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.sentFriendRequest(a._id,t._id);case 2:"succeeded"===e.sent.status&&(H.emitUpdateUserById(a._id),H.emitAddFriend(a,t._id));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(g.a,{onClick:s,color:"primary",variant:"contained",size:"small",className:n.buttonStyle,children:"Add friend"})})}var Mn=n(205),An=n(442),En=n(133),Ln=n.n(En);function Dn(e){var t=e.item,n=Object(k.c)(Q),c=qe(),s=Object(a.useState)(null),i=Object(o.a)(s,2),u=i[0],d=i[1],l=Boolean(u),f=function(){var e=Object(q.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.unfriend(n._id,t._id);case 2:"succeeded"===e.sent.status&&(H.emitUpdateUserById(n._id),H.emitUnfriend(n,t._id)),d(null);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)(ie.a,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:function(e){d(e.currentTarget)},children:Object(r.jsx)(Ln.a,{})}),Object(r.jsxs)(Mn.a,{id:"long-menu",anchorEl:u,keepMounted:!0,open:l,onClose:function(){d(null)},PaperProps:{style:{maxHeight:216,width:"20ch"}},children:[Object(r.jsx)(An.a,{children:Object(r.jsx)(Qe,{item:t,style:{width:"100%"},children:Object(r.jsx)(g.a,{onClick:function(){d(null)},variant:"contained",size:"small",fullWidth:!0,color:"primary",className:c.buttonStyle,children:"Chat"})})}),Object(r.jsx)(An.a,{children:Object(r.jsx)(g.a,{onClick:f,variant:"contained",size:"small",fullWidth:!0,className:c.buttonStyle,children:"Unfriend"})})]})]})}function Pn(e){var t=e.items,n=e.type,a=e.isLoading,s=Object(k.c)(Q),i=t.map((function(e,t){var a,c;c="friend"===(a=n||function(e,t){var n=e.friend,r=n.friend,a=n.request,c=n.sent_request;return r.indexOf(t)>-1?"friend":a.indexOf(t)>-1?"request":c.indexOf(t)>-1?"sent_request":"stranger"}(s,e._id))?Object(r.jsx)(Dn,{item:e}):"sent_request"===a?Object(r.jsx)(Nn,{item:e}):"request"===a?Object(r.jsx)(Bn,{item:e}):Object(r.jsx)(Tn,{item:e});var i=Object(r.jsxs)(Fn.a,{style:{justifyContent:"flex-end"},children:[" ",c," "]});return Object(r.jsx)(ke.a,{item:!0,xs:12,md:6,lg:4,children:Object(r.jsx)(qn.a,{children:Object(r.jsx)(Rn.a,{avatar:Object(r.jsx)(b,{name:e.username,picture:e.picture,children:" "}),action:i,title:e.username,subheader:null})})},t)})),o=Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(ke.a,{item:!0,xs:12,children:a?Object(r.jsx)(kt,{}):Object(r.jsx)(v.a,{align:"center",className:"text-muted",children:"Your list is empty"})})});return Object(r.jsx)(c.a.Fragment,{children:i.length>0?i:o})}var zn=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!0),i=Object(o.a)(s,2),u=i[0],d=i[1],l=Object(k.c)(Q);return Object(a.useEffect)((function(){var e=function(){var e=Object(q.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.findUsersByIds(l.friend.friend);case 3:"succeeded"===(t=e.sent).status&&c(t.payload),d(!1),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();l.friend.friend.length>0?e():(c([]),d(!1))}),[l.friend.friend]),Object(r.jsx)(Pn,{items:n,type:"friend",isLoading:u})},Wn=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!0),i=Object(o.a)(s,2),u=i[0],d=i[1],l=Object(k.c)(Q);return Object(a.useEffect)((function(){var e=function(){var e=Object(q.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.findUsersByIds(l.friend.sent_request);case 3:"succeeded"===(t=e.sent).status&&c(t.payload),d(!1),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();l.friend.sent_request.length>0?e():(d(!1),c([]))}),[l.friend.sent_request]),Object(r.jsx)(Pn,{items:n,type:"sent_request",isLoading:u})},Hn=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!0),i=Object(o.a)(s,2),u=i[0],d=i[1],l=Object(k.c)(Q);return Object(a.useEffect)((function(){var e=function(){var e=Object(q.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.findUsersByIds(l.friend.request);case 3:"succeeded"===(t=e.sent).status&&c(t.payload),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();l.friend.request.length>0?e():(c([]),d(!1)),d(!1)}),[l.friend.request]),Object(r.jsx)(Pn,{items:n,type:"request",isLoading:u})},Vn=function(e){var t=e.username,n=Object(a.useState)([]),c=Object(o.a)(n,2),s=c[0],i=c[1],u=Object(a.useState)(!0),d=Object(o.a)(u,2),l=d[0],f=d[1];return Object(a.useEffect)((function(){(function(){var e=Object(q.a)(F.a.mark((function e(){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.findStrangerByUsername(t);case 3:"succeeded"===(n=e.sent).status&&i(n.payload),f(!1),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}})()()}),[t]),Object(r.jsx)(Pn,{items:s,isLoading:l})};function Jn(e){var t=e.type,n=null,a=Object(k.c)($),c=Object(k.c)(Q);if(a)switch(t){case"friends_request":n=Object(r.jsx)(Hn,{username:c.username});break;case"friends_sent_request":n=Object(r.jsx)(Wn,{username:c.username});break;case"people_may_know":n=Object(r.jsx)(Vn,{username:c.username});break;default:n=Object(r.jsx)(zn,{username:c.username})}return Object(r.jsx)(ke.a,{style:{paddingTop:"8px",maxHeight:"500px",overflowY:"auto"},className:"custom-scrollbar",container:!0,spacing:2,children:n})}function Gn(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}var Yn=["friends_all","friends_request","friends_sent_request","people_may_know"];function Kn(){qe();var e=c.a.useState(0),t=Object(o.a)(e,2),n=t[0],s=t[1],i=Object(S.g)(),u=Object(S.i)();Object(a.useEffect)((function(){var e=u.friendsTab,t=Yn.indexOf(e);s(t=t<0?0:t)}),[u.friendsTab]);return Object(r.jsx)(c.a.Fragment,{children:Object(r.jsx)(x.a,{p:2,children:Object(r.jsxs)(ke.a,{container:!0,spacing:2,children:[Object(r.jsxs)(ke.a,{item:!0,xs:9,children:[Object(r.jsx)(tn,{title:"Friends"}),Object(r.jsxs)(x.a,{mt:1,children:[Object(r.jsx)(O.a,{position:"static",color:"default",children:Object(r.jsxs)(In.a,{value:n,onChange:function(e,t){s(t);var n=Yn[t];i.push("/".concat(n))},"aria-label":"simple tabs example",indicatorColor:"primary",className:"my-tabs",scrollButtons:"auto",variant:"scrollable",children:[Object(r.jsx)(Un.a,Object(se.a)({label:"All Friends"},Gn(0))),Object(r.jsx)(Un.a,Object(se.a)({label:"Friend Requests"},Gn(1))),Object(r.jsx)(Un.a,Object(se.a)({label:"Sent Requests"},Gn(2))),Object(r.jsx)(Un.a,Object(se.a)({label:"People you may know"},Gn(3)))]})}),Object(r.jsx)(Jn,{type:Yn[n]})]})]}),Object(r.jsxs)(ke.a,{item:!0,xs:3,children:[Object(r.jsx)(rn,{})," "]})]})})})}function Zn(e){var t=Object.assign({},e),n=Object(k.c)($),c=Object(S.h)(),s=Object(S.g)();return Object(a.useEffect)((function(){if(n){var e=(c.state||{from:{pathname:"/"}}).from;s.replace(e)}}),[n,c.state,s]),Object(r.jsx)(S.b,Object(se.a)({},t))}function $n(){window.addEventListener("scroll",(function(){window.scrollTo(0,0)}));var e=Object(ce.a)([Se]),t=Object(o.a)(e,1)[0],n=Object(k.c)(Q)||{},c=Object(k.c)(Je),s=Object(k.b)();Object(a.useEffect)((function(){return H.onUpdateUser((function(e){s(re(e))})),H.onFriendAccepted((function(e){H.emitUpdateUserById(n._id),s(Lt({message:E.format(Pt.friendAccepted,e.user.username),type:"info",open:!0}))})),H.onFriendRequested((function(e){H.emitUpdateUserById(n._id),s(Lt({message:E.format(Pt.friendRequested,e.user.username),type:"info",open:!0}))})),H.onFriendUnFriend((function(e){H.emitUpdateUserById(n._id)})),H.onFriendRequestCanceled((function(e){H.emitUpdateUserById(n._id)})),H.onFriendRejected((function(e){H.emitUpdateUserById(n._id)})),H.onNewMessageNotification((function(e){var t=e.message;e.conversationId!==c&&t.from._id!==n._id&&s(Lt({message:E.format(Pt.newMessage,t.from.username,t.text),type:"success",open:!0,timeout:2e3}))})),function(){H.off(W.updateUser),H.off(W.friendAccepted),H.off(W.friendRequested),H.off(W.friendUnfriend),H.off(W.friendRequestCanceled),H.off(W.friendRejected),H.off(W.newMessageNotification)}}),[n._id,c]),Object(a.useEffect)((function(){t.loggedUser&&s(V(t.loggedUser))}),[]);var i=Object(k.c)((function(e){return e.theme.type})),u=Object(_n.a)({palette:{type:i}});return Object(r.jsx)(kn.a,{theme:u,children:Object(r.jsx)(_.a,{base:"/",children:Object(r.jsx)(pt.a,{children:Object(r.jsxs)(x.a,{className:"wrapper",children:[Object(r.jsx)(_e,{}),Object(r.jsxs)(S.d,{children:[Object(r.jsxs)(Sn,{path:"/chat/:type(t|new)/:conversationId?",exact:!0,children:[" ",Object(r.jsx)(an,{})," "]}),Object(r.jsxs)(Sn,{path:"/:friendsTab(friends|friends_all|friends_request|friends_sent_request|people_may_know)",children:[Object(r.jsx)(Kn,{})," "]}),Object(r.jsx)(Zn,{path:"/login",exact:!0,component:pn}),Object(r.jsx)(Zn,{path:"/sign-up",exact:!0,component:xn}),Object(r.jsx)(S.a,{to:"/chat/new"})]}),Object(r.jsx)(Cn,{})]})})})})}var Qn=Object(R.a)({reducer:{chat:$e,notify:Dt,auth:ae,sidebarConversations:ft,newChat:_t,theme:pe}});i.a.render(Object(r.jsxs)(k.a,{store:Qn,children:[" ",Object(r.jsx)($n,{})," "]}),document.getElementById("root"))}},[[383,1,2]]]);
//# sourceMappingURL=main.d6b61bb2.chunk.js.map